{"version":3,"file":"index-PdlLPSjE.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../node_modules/@firebase/performance/dist/esm/index.esm2017.js","../../src/services/firebase/config.ts","../../src/services/firebase/ProgressService.ts","../../src/components/auth/AuthScreen.tsx","../../src/services/ai/PromptTemplates.ts","../../src/services/ai/GeminiService.ts","../../src/components/auth/APIKeySetup.tsx","../../src/components/dashboard/Dashboard.tsx","../../src/components/learning/LearningSession.tsx","../../src/components/progress/ProgressView.tsx","../../src/components/settings/SettingsView.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { ErrorFactory, areCookiesEnabled, isIndexedDBAvailable, validateIndexedDBOpenable, getModularInstance, deepEqual } from '@firebase/util';\nimport { Logger, LogLevel } from '@firebase/logger';\nimport { _getProvider, getApp, _registerComponent, registerVersion } from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport '@firebase/installations';\n\nconst name = \"@firebase/performance\";\nconst version = \"0.6.9\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst SDK_VERSION = version;\r\n/** The prefix for start User Timing marks used for creating Traces. */\r\nconst TRACE_START_MARK_PREFIX = 'FB-PERF-TRACE-START';\r\n/** The prefix for stop User Timing marks used for creating Traces. */\r\nconst TRACE_STOP_MARK_PREFIX = 'FB-PERF-TRACE-STOP';\r\n/** The prefix for User Timing measure used for creating Traces. */\r\nconst TRACE_MEASURE_PREFIX = 'FB-PERF-TRACE-MEASURE';\r\n/** The prefix for out of the box page load Trace name. */\r\nconst OOB_TRACE_PAGE_LOAD_PREFIX = '_wt_';\r\nconst FIRST_PAINT_COUNTER_NAME = '_fp';\r\nconst FIRST_CONTENTFUL_PAINT_COUNTER_NAME = '_fcp';\r\nconst FIRST_INPUT_DELAY_COUNTER_NAME = '_fid';\r\nconst CONFIG_LOCAL_STORAGE_KEY = '@firebase/performance/config';\r\nconst CONFIG_EXPIRY_LOCAL_STORAGE_KEY = '@firebase/performance/configexpire';\r\nconst SERVICE = 'performance';\r\nconst SERVICE_NAME = 'Performance';\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERROR_DESCRIPTION_MAP = {\r\n    [\"trace started\" /* ErrorCode.TRACE_STARTED_BEFORE */]: 'Trace {$traceName} was started before.',\r\n    [\"trace stopped\" /* ErrorCode.TRACE_STOPPED_BEFORE */]: 'Trace {$traceName} is not running.',\r\n    [\"nonpositive trace startTime\" /* ErrorCode.NONPOSITIVE_TRACE_START_TIME */]: 'Trace {$traceName} startTime should be positive.',\r\n    [\"nonpositive trace duration\" /* ErrorCode.NONPOSITIVE_TRACE_DURATION */]: 'Trace {$traceName} duration should be positive.',\r\n    [\"no window\" /* ErrorCode.NO_WINDOW */]: 'Window is not available.',\r\n    [\"no app id\" /* ErrorCode.NO_APP_ID */]: 'App id is not available.',\r\n    [\"no project id\" /* ErrorCode.NO_PROJECT_ID */]: 'Project id is not available.',\r\n    [\"no api key\" /* ErrorCode.NO_API_KEY */]: 'Api key is not available.',\r\n    [\"invalid cc log\" /* ErrorCode.INVALID_CC_LOG */]: 'Attempted to queue invalid cc event',\r\n    [\"FB not default\" /* ErrorCode.FB_NOT_DEFAULT */]: 'Performance can only start when Firebase app instance is the default one.',\r\n    [\"RC response not ok\" /* ErrorCode.RC_NOT_OK */]: 'RC response is not ok',\r\n    [\"invalid attribute name\" /* ErrorCode.INVALID_ATTRIBUTE_NAME */]: 'Attribute name {$attributeName} is invalid.',\r\n    [\"invalid attribute value\" /* ErrorCode.INVALID_ATTRIBUTE_VALUE */]: 'Attribute value {$attributeValue} is invalid.',\r\n    [\"invalid custom metric name\" /* ErrorCode.INVALID_CUSTOM_METRIC_NAME */]: 'Custom metric name {$customMetricName} is invalid',\r\n    [\"invalid String merger input\" /* ErrorCode.INVALID_STRING_MERGER_PARAMETER */]: 'Input for String merger is invalid, contact support team to resolve.',\r\n    [\"already initialized\" /* ErrorCode.ALREADY_INITIALIZED */]: 'initializePerformance() has already been called with ' +\r\n        'different options. To avoid this error, call initializePerformance() with the ' +\r\n        'same options as when it was originally called, or call getPerformance() to return the' +\r\n        ' already initialized instance.'\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst consoleLogger = new Logger(SERVICE_NAME);\r\nconsoleLogger.logLevel = LogLevel.INFO;\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet apiInstance;\r\nlet windowInstance;\r\n/**\r\n * This class holds a reference to various browser related objects injected by\r\n * set methods.\r\n */\r\nclass Api {\r\n    constructor(window) {\r\n        this.window = window;\r\n        if (!window) {\r\n            throw ERROR_FACTORY.create(\"no window\" /* ErrorCode.NO_WINDOW */);\r\n        }\r\n        this.performance = window.performance;\r\n        this.PerformanceObserver = window.PerformanceObserver;\r\n        this.windowLocation = window.location;\r\n        this.navigator = window.navigator;\r\n        this.document = window.document;\r\n        if (this.navigator && this.navigator.cookieEnabled) {\r\n            // If user blocks cookies on the browser, accessing localStorage will\r\n            // throw an exception.\r\n            this.localStorage = window.localStorage;\r\n        }\r\n        if (window.perfMetrics && window.perfMetrics.onFirstInputDelay) {\r\n            this.onFirstInputDelay = window.perfMetrics.onFirstInputDelay;\r\n        }\r\n    }\r\n    getUrl() {\r\n        // Do not capture the string query part of url.\r\n        return this.windowLocation.href.split('?')[0];\r\n    }\r\n    mark(name) {\r\n        if (!this.performance || !this.performance.mark) {\r\n            return;\r\n        }\r\n        this.performance.mark(name);\r\n    }\r\n    measure(measureName, mark1, mark2) {\r\n        if (!this.performance || !this.performance.measure) {\r\n            return;\r\n        }\r\n        this.performance.measure(measureName, mark1, mark2);\r\n    }\r\n    getEntriesByType(type) {\r\n        if (!this.performance || !this.performance.getEntriesByType) {\r\n            return [];\r\n        }\r\n        return this.performance.getEntriesByType(type);\r\n    }\r\n    getEntriesByName(name) {\r\n        if (!this.performance || !this.performance.getEntriesByName) {\r\n            return [];\r\n        }\r\n        return this.performance.getEntriesByName(name);\r\n    }\r\n    getTimeOrigin() {\r\n        // Polyfill the time origin with performance.timing.navigationStart.\r\n        return (this.performance &&\r\n            (this.performance.timeOrigin || this.performance.timing.navigationStart));\r\n    }\r\n    requiredApisAvailable() {\r\n        if (!fetch || !Promise || !areCookiesEnabled()) {\r\n            consoleLogger.info('Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.');\r\n            return false;\r\n        }\r\n        if (!isIndexedDBAvailable()) {\r\n            consoleLogger.info('IndexedDB is not supported by current browser');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    setupObserver(entryType, callback) {\r\n        if (!this.PerformanceObserver) {\r\n            return;\r\n        }\r\n        const observer = new this.PerformanceObserver(list => {\r\n            for (const entry of list.getEntries()) {\r\n                // `entry` is a PerformanceEntry instance.\r\n                callback(entry);\r\n            }\r\n        });\r\n        // Start observing the entry types you care about.\r\n        observer.observe({ entryTypes: [entryType] });\r\n    }\r\n    static getInstance() {\r\n        if (apiInstance === undefined) {\r\n            apiInstance = new Api(windowInstance);\r\n        }\r\n        return apiInstance;\r\n    }\r\n}\r\nfunction setupApi(window) {\r\n    windowInstance = window;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet iid;\r\nfunction getIidPromise(installationsService) {\r\n    const iidPromise = installationsService.getId();\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    iidPromise.then((iidVal) => {\r\n        iid = iidVal;\r\n    });\r\n    return iidPromise;\r\n}\r\n// This method should be used after the iid is retrieved by getIidPromise method.\r\nfunction getIid() {\r\n    return iid;\r\n}\r\nfunction getAuthTokenPromise(installationsService) {\r\n    const authTokenPromise = installationsService.getToken();\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    authTokenPromise.then((authTokenVal) => {\r\n    });\r\n    return authTokenPromise;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction mergeStrings(part1, part2) {\r\n    const sizeDiff = part1.length - part2.length;\r\n    if (sizeDiff < 0 || sizeDiff > 1) {\r\n        throw ERROR_FACTORY.create(\"invalid String merger input\" /* ErrorCode.INVALID_STRING_MERGER_PARAMETER */);\r\n    }\r\n    const resultArray = [];\r\n    for (let i = 0; i < part1.length; i++) {\r\n        resultArray.push(part1.charAt(i));\r\n        if (part2.length > i) {\r\n            resultArray.push(part2.charAt(i));\r\n        }\r\n    }\r\n    return resultArray.join('');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet settingsServiceInstance;\r\nclass SettingsService {\r\n    constructor() {\r\n        // The variable which controls logging of automatic traces and HTTP/S network monitoring.\r\n        this.instrumentationEnabled = true;\r\n        // The variable which controls logging of custom traces.\r\n        this.dataCollectionEnabled = true;\r\n        // Configuration flags set through remote config.\r\n        this.loggingEnabled = false;\r\n        // Sampling rate between 0 and 1.\r\n        this.tracesSamplingRate = 1;\r\n        this.networkRequestsSamplingRate = 1;\r\n        // Address of logging service.\r\n        this.logEndPointUrl = 'https://firebaselogging.googleapis.com/v0cc/log?format=json_proto';\r\n        // Performance event transport endpoint URL which should be compatible with proto3.\r\n        // New Address for transport service, not configurable via Remote Config.\r\n        this.flTransportEndpointUrl = mergeStrings('hts/frbslgigp.ogepscmv/ieo/eaylg', 'tp:/ieaeogn-agolai.o/1frlglgc/o');\r\n        this.transportKey = mergeStrings('AzSC8r6ReiGqFMyfvgow', 'Iayx0u-XT3vksVM-pIV');\r\n        // Source type for performance event logs.\r\n        this.logSource = 462;\r\n        // Flags which control per session logging of traces and network requests.\r\n        this.logTraceAfterSampling = false;\r\n        this.logNetworkAfterSampling = false;\r\n        // TTL of config retrieved from remote config in hours.\r\n        this.configTimeToLive = 12;\r\n    }\r\n    getFlTransportFullUrl() {\r\n        return this.flTransportEndpointUrl.concat('?key=', this.transportKey);\r\n    }\r\n    static getInstance() {\r\n        if (settingsServiceInstance === undefined) {\r\n            settingsServiceInstance = new SettingsService();\r\n        }\r\n        return settingsServiceInstance;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VisibilityState;\r\n(function (VisibilityState) {\r\n    VisibilityState[VisibilityState[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\r\n    VisibilityState[VisibilityState[\"VISIBLE\"] = 1] = \"VISIBLE\";\r\n    VisibilityState[VisibilityState[\"HIDDEN\"] = 2] = \"HIDDEN\";\r\n})(VisibilityState || (VisibilityState = {}));\r\nconst RESERVED_ATTRIBUTE_PREFIXES = ['firebase_', 'google_', 'ga_'];\r\nconst ATTRIBUTE_FORMAT_REGEX = new RegExp('^[a-zA-Z]\\\\w*$');\r\nconst MAX_ATTRIBUTE_NAME_LENGTH = 40;\r\nconst MAX_ATTRIBUTE_VALUE_LENGTH = 100;\r\nfunction getServiceWorkerStatus() {\r\n    const navigator = Api.getInstance().navigator;\r\n    if (navigator === null || navigator === void 0 ? void 0 : navigator.serviceWorker) {\r\n        if (navigator.serviceWorker.controller) {\r\n            return 2 /* ServiceWorkerStatus.CONTROLLED */;\r\n        }\r\n        else {\r\n            return 3 /* ServiceWorkerStatus.UNCONTROLLED */;\r\n        }\r\n    }\r\n    else {\r\n        return 1 /* ServiceWorkerStatus.UNSUPPORTED */;\r\n    }\r\n}\r\nfunction getVisibilityState() {\r\n    const document = Api.getInstance().document;\r\n    const visibilityState = document.visibilityState;\r\n    switch (visibilityState) {\r\n        case 'visible':\r\n            return VisibilityState.VISIBLE;\r\n        case 'hidden':\r\n            return VisibilityState.HIDDEN;\r\n        default:\r\n            return VisibilityState.UNKNOWN;\r\n    }\r\n}\r\nfunction getEffectiveConnectionType() {\r\n    const navigator = Api.getInstance().navigator;\r\n    const navigatorConnection = navigator.connection;\r\n    const effectiveType = navigatorConnection && navigatorConnection.effectiveType;\r\n    switch (effectiveType) {\r\n        case 'slow-2g':\r\n            return 1 /* EffectiveConnectionType.CONNECTION_SLOW_2G */;\r\n        case '2g':\r\n            return 2 /* EffectiveConnectionType.CONNECTION_2G */;\r\n        case '3g':\r\n            return 3 /* EffectiveConnectionType.CONNECTION_3G */;\r\n        case '4g':\r\n            return 4 /* EffectiveConnectionType.CONNECTION_4G */;\r\n        default:\r\n            return 0 /* EffectiveConnectionType.UNKNOWN */;\r\n    }\r\n}\r\nfunction isValidCustomAttributeName(name) {\r\n    if (name.length === 0 || name.length > MAX_ATTRIBUTE_NAME_LENGTH) {\r\n        return false;\r\n    }\r\n    const matchesReservedPrefix = RESERVED_ATTRIBUTE_PREFIXES.some(prefix => name.startsWith(prefix));\r\n    return !matchesReservedPrefix && !!name.match(ATTRIBUTE_FORMAT_REGEX);\r\n}\r\nfunction isValidCustomAttributeValue(value) {\r\n    return value.length !== 0 && value.length <= MAX_ATTRIBUTE_VALUE_LENGTH;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getAppId(firebaseApp) {\r\n    var _a;\r\n    const appId = (_a = firebaseApp.options) === null || _a === void 0 ? void 0 : _a.appId;\r\n    if (!appId) {\r\n        throw ERROR_FACTORY.create(\"no app id\" /* ErrorCode.NO_APP_ID */);\r\n    }\r\n    return appId;\r\n}\r\nfunction getProjectId(firebaseApp) {\r\n    var _a;\r\n    const projectId = (_a = firebaseApp.options) === null || _a === void 0 ? void 0 : _a.projectId;\r\n    if (!projectId) {\r\n        throw ERROR_FACTORY.create(\"no project id\" /* ErrorCode.NO_PROJECT_ID */);\r\n    }\r\n    return projectId;\r\n}\r\nfunction getApiKey(firebaseApp) {\r\n    var _a;\r\n    const apiKey = (_a = firebaseApp.options) === null || _a === void 0 ? void 0 : _a.apiKey;\r\n    if (!apiKey) {\r\n        throw ERROR_FACTORY.create(\"no api key\" /* ErrorCode.NO_API_KEY */);\r\n    }\r\n    return apiKey;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst REMOTE_CONFIG_SDK_VERSION = '0.0.1';\r\n// These values will be used if the remote config object is successfully\r\n// retrieved, but the template does not have these fields.\r\nconst DEFAULT_CONFIGS = {\r\n    loggingEnabled: true\r\n};\r\nconst FIS_AUTH_PREFIX = 'FIREBASE_INSTALLATIONS_AUTH';\r\nfunction getConfig(performanceController, iid) {\r\n    const config = getStoredConfig();\r\n    if (config) {\r\n        processConfig(config);\r\n        return Promise.resolve();\r\n    }\r\n    return getRemoteConfig(performanceController, iid)\r\n        .then(processConfig)\r\n        .then(config => storeConfig(config), \r\n    /** Do nothing for error, use defaults set in settings service. */\r\n    () => { });\r\n}\r\nfunction getStoredConfig() {\r\n    const localStorage = Api.getInstance().localStorage;\r\n    if (!localStorage) {\r\n        return;\r\n    }\r\n    const expiryString = localStorage.getItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY);\r\n    if (!expiryString || !configValid(expiryString)) {\r\n        return;\r\n    }\r\n    const configStringified = localStorage.getItem(CONFIG_LOCAL_STORAGE_KEY);\r\n    if (!configStringified) {\r\n        return;\r\n    }\r\n    try {\r\n        const configResponse = JSON.parse(configStringified);\r\n        return configResponse;\r\n    }\r\n    catch (_a) {\r\n        return;\r\n    }\r\n}\r\nfunction storeConfig(config) {\r\n    const localStorage = Api.getInstance().localStorage;\r\n    if (!config || !localStorage) {\r\n        return;\r\n    }\r\n    localStorage.setItem(CONFIG_LOCAL_STORAGE_KEY, JSON.stringify(config));\r\n    localStorage.setItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY, String(Date.now() +\r\n        SettingsService.getInstance().configTimeToLive * 60 * 60 * 1000));\r\n}\r\nconst COULD_NOT_GET_CONFIG_MSG = 'Could not fetch config, will use default configs';\r\nfunction getRemoteConfig(performanceController, iid) {\r\n    // Perf needs auth token only to retrieve remote config.\r\n    return getAuthTokenPromise(performanceController.installations)\r\n        .then(authToken => {\r\n        const projectId = getProjectId(performanceController.app);\r\n        const apiKey = getApiKey(performanceController.app);\r\n        const configEndPoint = `https://firebaseremoteconfig.googleapis.com/v1/projects/${projectId}/namespaces/fireperf:fetch?key=${apiKey}`;\r\n        const request = new Request(configEndPoint, {\r\n            method: 'POST',\r\n            headers: { Authorization: `${FIS_AUTH_PREFIX} ${authToken}` },\r\n            /* eslint-disable camelcase */\r\n            body: JSON.stringify({\r\n                app_instance_id: iid,\r\n                app_instance_id_token: authToken,\r\n                app_id: getAppId(performanceController.app),\r\n                app_version: SDK_VERSION,\r\n                sdk_version: REMOTE_CONFIG_SDK_VERSION\r\n            })\r\n            /* eslint-enable camelcase */\r\n        });\r\n        return fetch(request).then(response => {\r\n            if (response.ok) {\r\n                return response.json();\r\n            }\r\n            // In case response is not ok. This will be caught by catch.\r\n            throw ERROR_FACTORY.create(\"RC response not ok\" /* ErrorCode.RC_NOT_OK */);\r\n        });\r\n    })\r\n        .catch(() => {\r\n        consoleLogger.info(COULD_NOT_GET_CONFIG_MSG);\r\n        return undefined;\r\n    });\r\n}\r\n/**\r\n * Processes config coming either from calling RC or from local storage.\r\n * This method only runs if call is successful or config in storage\r\n * is valid.\r\n */\r\nfunction processConfig(config) {\r\n    if (!config) {\r\n        return config;\r\n    }\r\n    const settingsServiceInstance = SettingsService.getInstance();\r\n    const entries = config.entries || {};\r\n    if (entries.fpr_enabled !== undefined) {\r\n        // TODO: Change the assignment of loggingEnabled once the received type is\r\n        // known.\r\n        settingsServiceInstance.loggingEnabled =\r\n            String(entries.fpr_enabled) === 'true';\r\n    }\r\n    else {\r\n        // Config retrieved successfully, but there is no fpr_enabled in template.\r\n        // Use secondary configs value.\r\n        settingsServiceInstance.loggingEnabled = DEFAULT_CONFIGS.loggingEnabled;\r\n    }\r\n    if (entries.fpr_log_source) {\r\n        settingsServiceInstance.logSource = Number(entries.fpr_log_source);\r\n    }\r\n    else if (DEFAULT_CONFIGS.logSource) {\r\n        settingsServiceInstance.logSource = DEFAULT_CONFIGS.logSource;\r\n    }\r\n    if (entries.fpr_log_endpoint_url) {\r\n        settingsServiceInstance.logEndPointUrl = entries.fpr_log_endpoint_url;\r\n    }\r\n    else if (DEFAULT_CONFIGS.logEndPointUrl) {\r\n        settingsServiceInstance.logEndPointUrl = DEFAULT_CONFIGS.logEndPointUrl;\r\n    }\r\n    // Key from Remote Config has to be non-empty string, otherwise use local value.\r\n    if (entries.fpr_log_transport_key) {\r\n        settingsServiceInstance.transportKey = entries.fpr_log_transport_key;\r\n    }\r\n    else if (DEFAULT_CONFIGS.transportKey) {\r\n        settingsServiceInstance.transportKey = DEFAULT_CONFIGS.transportKey;\r\n    }\r\n    if (entries.fpr_vc_network_request_sampling_rate !== undefined) {\r\n        settingsServiceInstance.networkRequestsSamplingRate = Number(entries.fpr_vc_network_request_sampling_rate);\r\n    }\r\n    else if (DEFAULT_CONFIGS.networkRequestsSamplingRate !== undefined) {\r\n        settingsServiceInstance.networkRequestsSamplingRate =\r\n            DEFAULT_CONFIGS.networkRequestsSamplingRate;\r\n    }\r\n    if (entries.fpr_vc_trace_sampling_rate !== undefined) {\r\n        settingsServiceInstance.tracesSamplingRate = Number(entries.fpr_vc_trace_sampling_rate);\r\n    }\r\n    else if (DEFAULT_CONFIGS.tracesSamplingRate !== undefined) {\r\n        settingsServiceInstance.tracesSamplingRate =\r\n            DEFAULT_CONFIGS.tracesSamplingRate;\r\n    }\r\n    // Set the per session trace and network logging flags.\r\n    settingsServiceInstance.logTraceAfterSampling = shouldLogAfterSampling(settingsServiceInstance.tracesSamplingRate);\r\n    settingsServiceInstance.logNetworkAfterSampling = shouldLogAfterSampling(settingsServiceInstance.networkRequestsSamplingRate);\r\n    return config;\r\n}\r\nfunction configValid(expiry) {\r\n    return Number(expiry) > Date.now();\r\n}\r\nfunction shouldLogAfterSampling(samplingRate) {\r\n    return Math.random() <= samplingRate;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet initializationStatus = 1 /* InitializationStatus.notInitialized */;\r\nlet initializationPromise;\r\nfunction getInitializationPromise(performanceController) {\r\n    initializationStatus = 2 /* InitializationStatus.initializationPending */;\r\n    initializationPromise =\r\n        initializationPromise || initializePerf(performanceController);\r\n    return initializationPromise;\r\n}\r\nfunction isPerfInitialized() {\r\n    return initializationStatus === 3 /* InitializationStatus.initialized */;\r\n}\r\nfunction initializePerf(performanceController) {\r\n    return getDocumentReadyComplete()\r\n        .then(() => getIidPromise(performanceController.installations))\r\n        .then(iid => getConfig(performanceController, iid))\r\n        .then(() => changeInitializationStatus(), () => changeInitializationStatus());\r\n}\r\n/**\r\n * Returns a promise which resolves whenever the document readystate is complete or\r\n * immediately if it is called after page load complete.\r\n */\r\nfunction getDocumentReadyComplete() {\r\n    const document = Api.getInstance().document;\r\n    return new Promise(resolve => {\r\n        if (document && document.readyState !== 'complete') {\r\n            const handler = () => {\r\n                if (document.readyState === 'complete') {\r\n                    document.removeEventListener('readystatechange', handler);\r\n                    resolve();\r\n                }\r\n            };\r\n            document.addEventListener('readystatechange', handler);\r\n        }\r\n        else {\r\n            resolve();\r\n        }\r\n    });\r\n}\r\nfunction changeInitializationStatus() {\r\n    initializationStatus = 3 /* InitializationStatus.initialized */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DEFAULT_SEND_INTERVAL_MS = 10 * 1000;\r\nconst INITIAL_SEND_TIME_DELAY_MS = 5.5 * 1000;\r\n// If end point does not work, the call will be tried for these many times.\r\nconst DEFAULT_REMAINING_TRIES = 3;\r\nconst MAX_EVENT_COUNT_PER_REQUEST = 1000;\r\nlet remainingTries = DEFAULT_REMAINING_TRIES;\r\n/* eslint-enable camelcase */\r\nlet queue = [];\r\nlet isTransportSetup = false;\r\nfunction setupTransportService() {\r\n    if (!isTransportSetup) {\r\n        processQueue(INITIAL_SEND_TIME_DELAY_MS);\r\n        isTransportSetup = true;\r\n    }\r\n}\r\nfunction processQueue(timeOffset) {\r\n    setTimeout(() => {\r\n        // If there is no remainingTries left, stop retrying.\r\n        if (remainingTries === 0) {\r\n            return;\r\n        }\r\n        // If there are no events to process, wait for DEFAULT_SEND_INTERVAL_MS and try again.\r\n        if (!queue.length) {\r\n            return processQueue(DEFAULT_SEND_INTERVAL_MS);\r\n        }\r\n        dispatchQueueEvents();\r\n    }, timeOffset);\r\n}\r\nfunction dispatchQueueEvents() {\r\n    // Extract events up to the maximum cap of single logRequest from top of \"official queue\".\r\n    // The staged events will be used for current logRequest attempt, remaining events will be kept\r\n    // for next attempt.\r\n    const staged = queue.splice(0, MAX_EVENT_COUNT_PER_REQUEST);\r\n    /* eslint-disable camelcase */\r\n    // We will pass the JSON serialized event to the backend.\r\n    const log_event = staged.map(evt => ({\r\n        source_extension_json_proto3: evt.message,\r\n        event_time_ms: String(evt.eventTime)\r\n    }));\r\n    const data = {\r\n        request_time_ms: String(Date.now()),\r\n        client_info: {\r\n            client_type: 1,\r\n            js_client_info: {}\r\n        },\r\n        log_source: SettingsService.getInstance().logSource,\r\n        log_event\r\n    };\r\n    /* eslint-enable camelcase */\r\n    sendEventsToFl(data, staged).catch(() => {\r\n        // If the request fails for some reason, add the events that were attempted\r\n        // back to the primary queue to retry later.\r\n        queue = [...staged, ...queue];\r\n        remainingTries--;\r\n        consoleLogger.info(`Tries left: ${remainingTries}.`);\r\n        processQueue(DEFAULT_SEND_INTERVAL_MS);\r\n    });\r\n}\r\nfunction sendEventsToFl(data, staged) {\r\n    return postToFlEndpoint(data)\r\n        .then(res => {\r\n        if (!res.ok) {\r\n            consoleLogger.info('Call to Firebase backend failed.');\r\n        }\r\n        return res.json();\r\n    })\r\n        .then(res => {\r\n        // Find the next call wait time from the response.\r\n        const transportWait = Number(res.nextRequestWaitMillis);\r\n        let requestOffset = DEFAULT_SEND_INTERVAL_MS;\r\n        if (!isNaN(transportWait)) {\r\n            requestOffset = Math.max(transportWait, requestOffset);\r\n        }\r\n        // Delete request if response include RESPONSE_ACTION_UNKNOWN or DELETE_REQUEST action.\r\n        // Otherwise, retry request using normal scheduling if response include RETRY_REQUEST_LATER.\r\n        const logResponseDetails = res.logResponseDetails;\r\n        if (Array.isArray(logResponseDetails) &&\r\n            logResponseDetails.length > 0 &&\r\n            logResponseDetails[0].responseAction === 'RETRY_REQUEST_LATER') {\r\n            queue = [...staged, ...queue];\r\n            consoleLogger.info(`Retry transport request later.`);\r\n        }\r\n        remainingTries = DEFAULT_REMAINING_TRIES;\r\n        // Schedule the next process.\r\n        processQueue(requestOffset);\r\n    });\r\n}\r\nfunction postToFlEndpoint(data) {\r\n    const flTransportFullUrl = SettingsService.getInstance().getFlTransportFullUrl();\r\n    return fetch(flTransportFullUrl, {\r\n        method: 'POST',\r\n        body: JSON.stringify(data)\r\n    });\r\n}\r\nfunction addToQueue(evt) {\r\n    if (!evt.eventTime || !evt.message) {\r\n        throw ERROR_FACTORY.create(\"invalid cc log\" /* ErrorCode.INVALID_CC_LOG */);\r\n    }\r\n    // Add the new event to the queue.\r\n    queue = [...queue, evt];\r\n}\r\n/** Log handler for cc service to send the performance logs to the server. */\r\nfunction transportHandler(\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nserializer) {\r\n    return (...args) => {\r\n        const message = serializer(...args);\r\n        addToQueue({\r\n            message,\r\n            eventTime: Date.now()\r\n        });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet logger;\r\n// This method is not called before initialization.\r\nfunction sendLog(resource, resourceType) {\r\n    if (!logger) {\r\n        logger = transportHandler(serializer);\r\n    }\r\n    logger(resource, resourceType);\r\n}\r\nfunction logTrace(trace) {\r\n    const settingsService = SettingsService.getInstance();\r\n    // Do not log if trace is auto generated and instrumentation is disabled.\r\n    if (!settingsService.instrumentationEnabled && trace.isAuto) {\r\n        return;\r\n    }\r\n    // Do not log if trace is custom and data collection is disabled.\r\n    if (!settingsService.dataCollectionEnabled && !trace.isAuto) {\r\n        return;\r\n    }\r\n    // Do not log if required apis are not available.\r\n    if (!Api.getInstance().requiredApisAvailable()) {\r\n        return;\r\n    }\r\n    // Only log the page load auto traces if page is visible.\r\n    if (trace.isAuto && getVisibilityState() !== VisibilityState.VISIBLE) {\r\n        return;\r\n    }\r\n    if (isPerfInitialized()) {\r\n        sendTraceLog(trace);\r\n    }\r\n    else {\r\n        // Custom traces can be used before the initialization but logging\r\n        // should wait until after.\r\n        getInitializationPromise(trace.performanceController).then(() => sendTraceLog(trace), () => sendTraceLog(trace));\r\n    }\r\n}\r\nfunction sendTraceLog(trace) {\r\n    if (!getIid()) {\r\n        return;\r\n    }\r\n    const settingsService = SettingsService.getInstance();\r\n    if (!settingsService.loggingEnabled ||\r\n        !settingsService.logTraceAfterSampling) {\r\n        return;\r\n    }\r\n    setTimeout(() => sendLog(trace, 1 /* ResourceType.Trace */), 0);\r\n}\r\nfunction logNetworkRequest(networkRequest) {\r\n    const settingsService = SettingsService.getInstance();\r\n    // Do not log network requests if instrumentation is disabled.\r\n    if (!settingsService.instrumentationEnabled) {\r\n        return;\r\n    }\r\n    // Do not log the js sdk's call to transport service domain to avoid unnecessary cycle.\r\n    // Need to blacklist both old and new endpoints to avoid migration gap.\r\n    const networkRequestUrl = networkRequest.url;\r\n    // Blacklist old log endpoint and new transport endpoint.\r\n    // Because Performance SDK doesn't instrument requests sent from SDK itself.\r\n    const logEndpointUrl = settingsService.logEndPointUrl.split('?')[0];\r\n    const flEndpointUrl = settingsService.flTransportEndpointUrl.split('?')[0];\r\n    if (networkRequestUrl === logEndpointUrl ||\r\n        networkRequestUrl === flEndpointUrl) {\r\n        return;\r\n    }\r\n    if (!settingsService.loggingEnabled ||\r\n        !settingsService.logNetworkAfterSampling) {\r\n        return;\r\n    }\r\n    setTimeout(() => sendLog(networkRequest, 0 /* ResourceType.NetworkRequest */), 0);\r\n}\r\nfunction serializer(resource, resourceType) {\r\n    if (resourceType === 0 /* ResourceType.NetworkRequest */) {\r\n        return serializeNetworkRequest(resource);\r\n    }\r\n    return serializeTrace(resource);\r\n}\r\nfunction serializeNetworkRequest(networkRequest) {\r\n    const networkRequestMetric = {\r\n        url: networkRequest.url,\r\n        http_method: networkRequest.httpMethod || 0,\r\n        http_response_code: 200,\r\n        response_payload_bytes: networkRequest.responsePayloadBytes,\r\n        client_start_time_us: networkRequest.startTimeUs,\r\n        time_to_response_initiated_us: networkRequest.timeToResponseInitiatedUs,\r\n        time_to_response_completed_us: networkRequest.timeToResponseCompletedUs\r\n    };\r\n    const perfMetric = {\r\n        application_info: getApplicationInfo(networkRequest.performanceController.app),\r\n        network_request_metric: networkRequestMetric\r\n    };\r\n    return JSON.stringify(perfMetric);\r\n}\r\nfunction serializeTrace(trace) {\r\n    const traceMetric = {\r\n        name: trace.name,\r\n        is_auto: trace.isAuto,\r\n        client_start_time_us: trace.startTimeUs,\r\n        duration_us: trace.durationUs\r\n    };\r\n    if (Object.keys(trace.counters).length !== 0) {\r\n        traceMetric.counters = trace.counters;\r\n    }\r\n    const customAttributes = trace.getAttributes();\r\n    if (Object.keys(customAttributes).length !== 0) {\r\n        traceMetric.custom_attributes = customAttributes;\r\n    }\r\n    const perfMetric = {\r\n        application_info: getApplicationInfo(trace.performanceController.app),\r\n        trace_metric: traceMetric\r\n    };\r\n    return JSON.stringify(perfMetric);\r\n}\r\nfunction getApplicationInfo(firebaseApp) {\r\n    return {\r\n        google_app_id: getAppId(firebaseApp),\r\n        app_instance_id: getIid(),\r\n        web_app_info: {\r\n            sdk_version: SDK_VERSION,\r\n            page_url: Api.getInstance().getUrl(),\r\n            service_worker_status: getServiceWorkerStatus(),\r\n            visibility_state: getVisibilityState(),\r\n            effective_connection_type: getEffectiveConnectionType()\r\n        },\r\n        application_process_state: 0\r\n    };\r\n}\r\n/* eslint-enable camelcase */\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst MAX_METRIC_NAME_LENGTH = 100;\r\nconst RESERVED_AUTO_PREFIX = '_';\r\nconst oobMetrics = [\r\n    FIRST_PAINT_COUNTER_NAME,\r\n    FIRST_CONTENTFUL_PAINT_COUNTER_NAME,\r\n    FIRST_INPUT_DELAY_COUNTER_NAME\r\n];\r\n/**\r\n * Returns true if the metric is custom and does not start with reserved prefix, or if\r\n * the metric is one of out of the box page load trace metrics.\r\n */\r\nfunction isValidMetricName(name, traceName) {\r\n    if (name.length === 0 || name.length > MAX_METRIC_NAME_LENGTH) {\r\n        return false;\r\n    }\r\n    return ((traceName &&\r\n        traceName.startsWith(OOB_TRACE_PAGE_LOAD_PREFIX) &&\r\n        oobMetrics.indexOf(name) > -1) ||\r\n        !name.startsWith(RESERVED_AUTO_PREFIX));\r\n}\r\n/**\r\n * Converts the provided value to an integer value to be used in case of a metric.\r\n * @param providedValue Provided number value of the metric that needs to be converted to an integer.\r\n *\r\n * @returns Converted integer number to be set for the metric.\r\n */\r\nfunction convertMetricValueToInteger(providedValue) {\r\n    const valueAsInteger = Math.floor(providedValue);\r\n    if (valueAsInteger < providedValue) {\r\n        consoleLogger.info(`Metric value should be an Integer, setting the value as : ${valueAsInteger}.`);\r\n    }\r\n    return valueAsInteger;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Trace {\r\n    /**\r\n     * @param performanceController The performance controller running.\r\n     * @param name The name of the trace.\r\n     * @param isAuto If the trace is auto-instrumented.\r\n     * @param traceMeasureName The name of the measure marker in user timing specification. This field\r\n     * is only set when the trace is built for logging when the user directly uses the user timing\r\n     * api (performance.mark and performance.measure).\r\n     */\r\n    constructor(performanceController, name, isAuto = false, traceMeasureName) {\r\n        this.performanceController = performanceController;\r\n        this.name = name;\r\n        this.isAuto = isAuto;\r\n        this.state = 1 /* TraceState.UNINITIALIZED */;\r\n        this.customAttributes = {};\r\n        this.counters = {};\r\n        this.api = Api.getInstance();\r\n        this.randomId = Math.floor(Math.random() * 1000000);\r\n        if (!this.isAuto) {\r\n            this.traceStartMark = `${TRACE_START_MARK_PREFIX}-${this.randomId}-${this.name}`;\r\n            this.traceStopMark = `${TRACE_STOP_MARK_PREFIX}-${this.randomId}-${this.name}`;\r\n            this.traceMeasure =\r\n                traceMeasureName ||\r\n                    `${TRACE_MEASURE_PREFIX}-${this.randomId}-${this.name}`;\r\n            if (traceMeasureName) {\r\n                // For the case of direct user timing traces, no start stop will happen. The measure object\r\n                // is already available.\r\n                this.calculateTraceMetrics();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Starts a trace. The measurement of the duration starts at this point.\r\n     */\r\n    start() {\r\n        if (this.state !== 1 /* TraceState.UNINITIALIZED */) {\r\n            throw ERROR_FACTORY.create(\"trace started\" /* ErrorCode.TRACE_STARTED_BEFORE */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        this.api.mark(this.traceStartMark);\r\n        this.state = 2 /* TraceState.RUNNING */;\r\n    }\r\n    /**\r\n     * Stops the trace. The measurement of the duration of the trace stops at this point and trace\r\n     * is logged.\r\n     */\r\n    stop() {\r\n        if (this.state !== 2 /* TraceState.RUNNING */) {\r\n            throw ERROR_FACTORY.create(\"trace stopped\" /* ErrorCode.TRACE_STOPPED_BEFORE */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        this.state = 3 /* TraceState.TERMINATED */;\r\n        this.api.mark(this.traceStopMark);\r\n        this.api.measure(this.traceMeasure, this.traceStartMark, this.traceStopMark);\r\n        this.calculateTraceMetrics();\r\n        logTrace(this);\r\n    }\r\n    /**\r\n     * Records a trace with predetermined values. If this method is used a trace is created and logged\r\n     * directly. No need to use start and stop methods.\r\n     * @param startTime Trace start time since epoch in millisec\r\n     * @param duration The duration of the trace in millisec\r\n     * @param options An object which can optionally hold maps of custom metrics and custom attributes\r\n     */\r\n    record(startTime, duration, options) {\r\n        if (startTime <= 0) {\r\n            throw ERROR_FACTORY.create(\"nonpositive trace startTime\" /* ErrorCode.NONPOSITIVE_TRACE_START_TIME */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        if (duration <= 0) {\r\n            throw ERROR_FACTORY.create(\"nonpositive trace duration\" /* ErrorCode.NONPOSITIVE_TRACE_DURATION */, {\r\n                traceName: this.name\r\n            });\r\n        }\r\n        this.durationUs = Math.floor(duration * 1000);\r\n        this.startTimeUs = Math.floor(startTime * 1000);\r\n        if (options && options.attributes) {\r\n            this.customAttributes = Object.assign({}, options.attributes);\r\n        }\r\n        if (options && options.metrics) {\r\n            for (const metricName of Object.keys(options.metrics)) {\r\n                if (!isNaN(Number(options.metrics[metricName]))) {\r\n                    this.counters[metricName] = Math.floor(Number(options.metrics[metricName]));\r\n                }\r\n            }\r\n        }\r\n        logTrace(this);\r\n    }\r\n    /**\r\n     * Increments a custom metric by a certain number or 1 if number not specified. Will create a new\r\n     * custom metric if one with the given name does not exist. The value will be floored down to an\r\n     * integer.\r\n     * @param counter Name of the custom metric\r\n     * @param numAsInteger Increment by value\r\n     */\r\n    incrementMetric(counter, numAsInteger = 1) {\r\n        if (this.counters[counter] === undefined) {\r\n            this.putMetric(counter, numAsInteger);\r\n        }\r\n        else {\r\n            this.putMetric(counter, this.counters[counter] + numAsInteger);\r\n        }\r\n    }\r\n    /**\r\n     * Sets a custom metric to a specified value. Will create a new custom metric if one with the\r\n     * given name does not exist. The value will be floored down to an integer.\r\n     * @param counter Name of the custom metric\r\n     * @param numAsInteger Set custom metric to this value\r\n     */\r\n    putMetric(counter, numAsInteger) {\r\n        if (isValidMetricName(counter, this.name)) {\r\n            this.counters[counter] = convertMetricValueToInteger(numAsInteger !== null && numAsInteger !== void 0 ? numAsInteger : 0);\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"invalid custom metric name\" /* ErrorCode.INVALID_CUSTOM_METRIC_NAME */, {\r\n                customMetricName: counter\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Returns the value of the custom metric by that name. If a custom metric with that name does\r\n     * not exist will return zero.\r\n     * @param counter\r\n     */\r\n    getMetric(counter) {\r\n        return this.counters[counter] || 0;\r\n    }\r\n    /**\r\n     * Sets a custom attribute of a trace to a certain value.\r\n     * @param attr\r\n     * @param value\r\n     */\r\n    putAttribute(attr, value) {\r\n        const isValidName = isValidCustomAttributeName(attr);\r\n        const isValidValue = isValidCustomAttributeValue(value);\r\n        if (isValidName && isValidValue) {\r\n            this.customAttributes[attr] = value;\r\n            return;\r\n        }\r\n        // Throw appropriate error when the attribute name or value is invalid.\r\n        if (!isValidName) {\r\n            throw ERROR_FACTORY.create(\"invalid attribute name\" /* ErrorCode.INVALID_ATTRIBUTE_NAME */, {\r\n                attributeName: attr\r\n            });\r\n        }\r\n        if (!isValidValue) {\r\n            throw ERROR_FACTORY.create(\"invalid attribute value\" /* ErrorCode.INVALID_ATTRIBUTE_VALUE */, {\r\n                attributeValue: value\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Retrieves the value a custom attribute of a trace is set to.\r\n     * @param attr\r\n     */\r\n    getAttribute(attr) {\r\n        return this.customAttributes[attr];\r\n    }\r\n    removeAttribute(attr) {\r\n        if (this.customAttributes[attr] === undefined) {\r\n            return;\r\n        }\r\n        delete this.customAttributes[attr];\r\n    }\r\n    getAttributes() {\r\n        return Object.assign({}, this.customAttributes);\r\n    }\r\n    setStartTime(startTime) {\r\n        this.startTimeUs = startTime;\r\n    }\r\n    setDuration(duration) {\r\n        this.durationUs = duration;\r\n    }\r\n    /**\r\n     * Calculates and assigns the duration and start time of the trace using the measure performance\r\n     * entry.\r\n     */\r\n    calculateTraceMetrics() {\r\n        const perfMeasureEntries = this.api.getEntriesByName(this.traceMeasure);\r\n        const perfMeasureEntry = perfMeasureEntries && perfMeasureEntries[0];\r\n        if (perfMeasureEntry) {\r\n            this.durationUs = Math.floor(perfMeasureEntry.duration * 1000);\r\n            this.startTimeUs = Math.floor((perfMeasureEntry.startTime + this.api.getTimeOrigin()) * 1000);\r\n        }\r\n    }\r\n    /**\r\n     * @param navigationTimings A single element array which contains the navigationTIming object of\r\n     * the page load\r\n     * @param paintTimings A array which contains paintTiming object of the page load\r\n     * @param firstInputDelay First input delay in millisec\r\n     */\r\n    static createOobTrace(performanceController, navigationTimings, paintTimings, firstInputDelay) {\r\n        const route = Api.getInstance().getUrl();\r\n        if (!route) {\r\n            return;\r\n        }\r\n        const trace = new Trace(performanceController, OOB_TRACE_PAGE_LOAD_PREFIX + route, true);\r\n        const timeOriginUs = Math.floor(Api.getInstance().getTimeOrigin() * 1000);\r\n        trace.setStartTime(timeOriginUs);\r\n        // navigationTimings includes only one element.\r\n        if (navigationTimings && navigationTimings[0]) {\r\n            trace.setDuration(Math.floor(navigationTimings[0].duration * 1000));\r\n            trace.putMetric('domInteractive', Math.floor(navigationTimings[0].domInteractive * 1000));\r\n            trace.putMetric('domContentLoadedEventEnd', Math.floor(navigationTimings[0].domContentLoadedEventEnd * 1000));\r\n            trace.putMetric('loadEventEnd', Math.floor(navigationTimings[0].loadEventEnd * 1000));\r\n        }\r\n        const FIRST_PAINT = 'first-paint';\r\n        const FIRST_CONTENTFUL_PAINT = 'first-contentful-paint';\r\n        if (paintTimings) {\r\n            const firstPaint = paintTimings.find(paintObject => paintObject.name === FIRST_PAINT);\r\n            if (firstPaint && firstPaint.startTime) {\r\n                trace.putMetric(FIRST_PAINT_COUNTER_NAME, Math.floor(firstPaint.startTime * 1000));\r\n            }\r\n            const firstContentfulPaint = paintTimings.find(paintObject => paintObject.name === FIRST_CONTENTFUL_PAINT);\r\n            if (firstContentfulPaint && firstContentfulPaint.startTime) {\r\n                trace.putMetric(FIRST_CONTENTFUL_PAINT_COUNTER_NAME, Math.floor(firstContentfulPaint.startTime * 1000));\r\n            }\r\n            if (firstInputDelay) {\r\n                trace.putMetric(FIRST_INPUT_DELAY_COUNTER_NAME, Math.floor(firstInputDelay * 1000));\r\n            }\r\n        }\r\n        logTrace(trace);\r\n    }\r\n    static createUserTimingTrace(performanceController, measureName) {\r\n        const trace = new Trace(performanceController, measureName, false, measureName);\r\n        logTrace(trace);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createNetworkRequestEntry(performanceController, entry) {\r\n    const performanceEntry = entry;\r\n    if (!performanceEntry || performanceEntry.responseStart === undefined) {\r\n        return;\r\n    }\r\n    const timeOrigin = Api.getInstance().getTimeOrigin();\r\n    const startTimeUs = Math.floor((performanceEntry.startTime + timeOrigin) * 1000);\r\n    const timeToResponseInitiatedUs = performanceEntry.responseStart\r\n        ? Math.floor((performanceEntry.responseStart - performanceEntry.startTime) * 1000)\r\n        : undefined;\r\n    const timeToResponseCompletedUs = Math.floor((performanceEntry.responseEnd - performanceEntry.startTime) * 1000);\r\n    // Remove the query params from logged network request url.\r\n    const url = performanceEntry.name && performanceEntry.name.split('?')[0];\r\n    const networkRequest = {\r\n        performanceController,\r\n        url,\r\n        responsePayloadBytes: performanceEntry.transferSize,\r\n        startTimeUs,\r\n        timeToResponseInitiatedUs,\r\n        timeToResponseCompletedUs\r\n    };\r\n    logNetworkRequest(networkRequest);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst FID_WAIT_TIME_MS = 5000;\r\nfunction setupOobResources(performanceController) {\r\n    // Do not initialize unless iid is available.\r\n    if (!getIid()) {\r\n        return;\r\n    }\r\n    // The load event might not have fired yet, and that means performance navigation timing\r\n    // object has a duration of 0. The setup should run after all current tasks in js queue.\r\n    setTimeout(() => setupOobTraces(performanceController), 0);\r\n    setTimeout(() => setupNetworkRequests(performanceController), 0);\r\n    setTimeout(() => setupUserTimingTraces(performanceController), 0);\r\n}\r\nfunction setupNetworkRequests(performanceController) {\r\n    const api = Api.getInstance();\r\n    const resources = api.getEntriesByType('resource');\r\n    for (const resource of resources) {\r\n        createNetworkRequestEntry(performanceController, resource);\r\n    }\r\n    api.setupObserver('resource', entry => createNetworkRequestEntry(performanceController, entry));\r\n}\r\nfunction setupOobTraces(performanceController) {\r\n    const api = Api.getInstance();\r\n    const navigationTimings = api.getEntriesByType('navigation');\r\n    const paintTimings = api.getEntriesByType('paint');\r\n    // If First Input Delay polyfill is added to the page, report the fid value.\r\n    // https://github.com/GoogleChromeLabs/first-input-delay\r\n    if (api.onFirstInputDelay) {\r\n        // If the fid call back is not called for certain time, continue without it.\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        let timeoutId = setTimeout(() => {\r\n            Trace.createOobTrace(performanceController, navigationTimings, paintTimings);\r\n            timeoutId = undefined;\r\n        }, FID_WAIT_TIME_MS);\r\n        api.onFirstInputDelay((fid) => {\r\n            if (timeoutId) {\r\n                clearTimeout(timeoutId);\r\n                Trace.createOobTrace(performanceController, navigationTimings, paintTimings, fid);\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        Trace.createOobTrace(performanceController, navigationTimings, paintTimings);\r\n    }\r\n}\r\nfunction setupUserTimingTraces(performanceController) {\r\n    const api = Api.getInstance();\r\n    // Run through the measure performance entries collected up to this point.\r\n    const measures = api.getEntriesByType('measure');\r\n    for (const measure of measures) {\r\n        createUserTimingTrace(performanceController, measure);\r\n    }\r\n    // Setup an observer to capture the measures from this point on.\r\n    api.setupObserver('measure', entry => createUserTimingTrace(performanceController, entry));\r\n}\r\nfunction createUserTimingTrace(performanceController, measure) {\r\n    const measureName = measure.name;\r\n    // Do not create a trace, if the user timing marks and measures are created by the sdk itself.\r\n    if (measureName.substring(0, TRACE_MEASURE_PREFIX.length) ===\r\n        TRACE_MEASURE_PREFIX) {\r\n        return;\r\n    }\r\n    Trace.createUserTimingTrace(performanceController, measureName);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass PerformanceController {\r\n    constructor(app, installations) {\r\n        this.app = app;\r\n        this.installations = installations;\r\n        this.initialized = false;\r\n    }\r\n    /**\r\n     * This method *must* be called internally as part of creating a\r\n     * PerformanceController instance.\r\n     *\r\n     * Currently it's not possible to pass the settings object through the\r\n     * constructor using Components, so this method exists to be called with the\r\n     * desired settings, to ensure nothing is collected without the user's\r\n     * consent.\r\n     */\r\n    _init(settings) {\r\n        if (this.initialized) {\r\n            return;\r\n        }\r\n        if ((settings === null || settings === void 0 ? void 0 : settings.dataCollectionEnabled) !== undefined) {\r\n            this.dataCollectionEnabled = settings.dataCollectionEnabled;\r\n        }\r\n        if ((settings === null || settings === void 0 ? void 0 : settings.instrumentationEnabled) !== undefined) {\r\n            this.instrumentationEnabled = settings.instrumentationEnabled;\r\n        }\r\n        if (Api.getInstance().requiredApisAvailable()) {\r\n            validateIndexedDBOpenable()\r\n                .then(isAvailable => {\r\n                if (isAvailable) {\r\n                    setupTransportService();\r\n                    getInitializationPromise(this).then(() => setupOobResources(this), () => setupOobResources(this));\r\n                    this.initialized = true;\r\n                }\r\n            })\r\n                .catch(error => {\r\n                consoleLogger.info(`Environment doesn't support IndexedDB: ${error}`);\r\n            });\r\n        }\r\n        else {\r\n            consoleLogger.info('Firebase Performance cannot start if the browser does not support ' +\r\n                '\"Fetch\" and \"Promise\", or cookies are disabled.');\r\n        }\r\n    }\r\n    set instrumentationEnabled(val) {\r\n        SettingsService.getInstance().instrumentationEnabled = val;\r\n    }\r\n    get instrumentationEnabled() {\r\n        return SettingsService.getInstance().instrumentationEnabled;\r\n    }\r\n    set dataCollectionEnabled(val) {\r\n        SettingsService.getInstance().dataCollectionEnabled = val;\r\n    }\r\n    get dataCollectionEnabled() {\r\n        return SettingsService.getInstance().dataCollectionEnabled;\r\n    }\r\n}\n\n/**\r\n * The Firebase Performance Monitoring Web SDK.\r\n * This SDK does not work in a Node.js environment.\r\n *\r\n * @packageDocumentation\r\n */\r\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\n/**\r\n * Returns a {@link FirebasePerformance} instance for the given app.\r\n * @param app - The {@link @firebase/app#FirebaseApp} to use.\r\n * @public\r\n */\r\nfunction getPerformance(app = getApp()) {\r\n    app = getModularInstance(app);\r\n    const provider = _getProvider(app, 'performance');\r\n    const perfInstance = provider.getImmediate();\r\n    return perfInstance;\r\n}\r\n/**\r\n * Returns a {@link FirebasePerformance} instance for the given app. Can only be called once.\r\n * @param app - The {@link @firebase/app#FirebaseApp} to use.\r\n * @param settings - Optional settings for the {@link FirebasePerformance} instance.\r\n * @public\r\n */\r\nfunction initializePerformance(app, settings) {\r\n    app = getModularInstance(app);\r\n    const provider = _getProvider(app, 'performance');\r\n    // throw if an instance was already created.\r\n    // It could happen if initializePerformance() is called more than once, or getPerformance() is called first.\r\n    if (provider.isInitialized()) {\r\n        const existingInstance = provider.getImmediate();\r\n        const initialSettings = provider.getOptions();\r\n        if (deepEqual(initialSettings, settings !== null && settings !== void 0 ? settings : {})) {\r\n            return existingInstance;\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"already initialized\" /* ErrorCode.ALREADY_INITIALIZED */);\r\n        }\r\n    }\r\n    const perfInstance = provider.initialize({\r\n        options: settings\r\n    });\r\n    return perfInstance;\r\n}\r\n/**\r\n * Returns a new `PerformanceTrace` instance.\r\n * @param performance - The {@link FirebasePerformance} instance to use.\r\n * @param name - The name of the trace.\r\n * @public\r\n */\r\nfunction trace(performance, name) {\r\n    performance = getModularInstance(performance);\r\n    return new Trace(performance, name);\r\n}\r\nconst factory = (container, { options: settings }) => {\r\n    // Dependencies\r\n    const app = container.getProvider('app').getImmediate();\r\n    const installations = container\r\n        .getProvider('installations-internal')\r\n        .getImmediate();\r\n    if (app.name !== DEFAULT_ENTRY_NAME) {\r\n        throw ERROR_FACTORY.create(\"FB not default\" /* ErrorCode.FB_NOT_DEFAULT */);\r\n    }\r\n    if (typeof window === 'undefined') {\r\n        throw ERROR_FACTORY.create(\"no window\" /* ErrorCode.NO_WINDOW */);\r\n    }\r\n    setupApi(window);\r\n    const perfInstance = new PerformanceController(app, installations);\r\n    perfInstance._init(settings);\r\n    return perfInstance;\r\n};\r\nfunction registerPerformance() {\r\n    _registerComponent(new Component('performance', factory, \"PUBLIC\" /* ComponentType.PUBLIC */));\r\n    registerVersion(name, version);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name, version, 'esm2017');\r\n}\r\nregisterPerformance();\n\nexport { getPerformance, initializePerformance, trace };\n//# sourceMappingURL=index.esm2017.js.map\n","/**\n * FIREBASE CONFIGURATION - ENGLISH MASTER APP\n * Configuración completa de Firebase con todas las funcionalidades\n */\n\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, connectAuthEmulator } from 'firebase/auth';\nimport { getFirestore, connectFirestoreEmulator } from 'firebase/firestore';\nimport { getAnalytics, isSupported } from 'firebase/analytics';\nimport { getPerformance } from 'firebase/performance';\n\n// Configuración de Firebase - REEMPLAZAR CON TUS CREDENCIALES\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY || \"tu-api-key-aqui\",\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN || \"english-master-app.firebaseapp.com\",\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID || \"english-master-app\",\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET || \"english-master-app.appspot.com\",\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID || \"123456789012\",\n  appId: import.meta.env.VITE_FIREBASE_APP_ID || \"1:123456789012:web:abcdef123456\",\n  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID || \"G-XXXXXXXXXX\"\n};\n\n// Inicializar Firebase\nconst app = initializeApp(firebaseConfig);\n\n// Inicializar servicios\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\n\n// Analytics (solo en producción)\nlet analytics: any = null;\nlet performance: any = null;\n\nif (typeof window !== 'undefined') {\n  // Analytics\n  isSupported().then((supported) => {\n    if (supported) {\n      analytics = getAnalytics(app);\n      console.log('📊 Firebase Analytics initialized');\n    }\n  });\n\n  // Performance Monitoring\n  if (import.meta.env.PROD) {\n    performance = getPerformance(app);\n    console.log('⚡ Firebase Performance initialized');\n  }\n}\n\nexport { analytics, performance };\n\n// Configuración de emuladores para desarrollo\nif (import.meta.env.DEV && typeof window !== 'undefined') {\n  const isEmulatorConnected = localStorage.getItem('firebase_emulator_connected');\n  \n  if (!isEmulatorConnected) {\n    try {\n      // Conectar a emuladores locales si están disponibles\n      connectAuthEmulator(auth, 'http://localhost:9099', { disableWarnings: true });\n      connectFirestoreEmulator(db, 'localhost', 8080);\n      \n      localStorage.setItem('firebase_emulator_connected', 'true');\n      console.log('🧪 Firebase emulators connected');\n    } catch (error) {\n      console.log('📡 Using production Firebase services');\n    }\n  }\n}\n\n// Configuración de persistencia de autenticación\nauth.useDeviceLanguage();\n\nconsole.log('🔥 Firebase initialized successfully');\nconsole.log('🏗️ Environment:', import.meta.env.MODE);\nconsole.log('📱 Project ID:', firebaseConfig.projectId);\n\nexport default app;","/**\n * FIREBASE PROGRESS SERVICE - SISTEMA COMPLETO\n * English Master App - Gestión de Progreso del Usuario\n */\n\nimport { \n  getFirestore, \n  doc, \n  setDoc, \n  getDoc, \n  updateDoc, \n  collection, \n  addDoc, \n  query, \n  where, \n  orderBy, \n  limit, \n  getDocs,\n  runTransaction,\n  Timestamp \n} from 'firebase/firestore';\n\nimport { \n  UserProgress, \n  LevelStats, \n  SessionResults, \n  DailyProgress, \n  ExerciseStats,\n  Level,\n  LevelRequirements,\n  ProgressCalculation \n} from '../../types/progress';\n\nexport class ProgressService {\n  private db = getFirestore();\n\n  // REQUIREMENTS POR NIVEL - ALCANZABLES PERO DESAFIANTES\n  private static LEVEL_REQUIREMENTS: Record<Level, LevelRequirements> = {\n    A1: {\n      minExercises: 40,\n      minAccuracy: 0.70,\n      minSessions: 5,\n      minTimeSpent: 60, // 1 hora\n      skillsRequired: ['social_greetings', 'basic_needs', 'courtesy', 'personal_info'],\n      description: 'Supervivencia básica en inglés'\n    },\n    A2: {\n      minExercises: 80,\n      minAccuracy: 0.75,\n      minSessions: 10,\n      minTimeSpent: 120, // 2 horas\n      skillsRequired: ['daily_routines', 'past_experiences', 'future_plans', 'preferences'],\n      description: 'Comunicación cotidiana'\n    },\n    B1: {\n      minExercises: 120,\n      minAccuracy: 0.80,\n      minSessions: 15,\n      minTimeSpent: 180, // 3 horas\n      skillsRequired: ['work_situations', 'problem_solving', 'opinions', 'hypotheticals'],\n      description: 'Independencia comunicativa'\n    },\n    B2: {\n      minExercises: 160,\n      minAccuracy: 0.85,\n      minSessions: 20,\n      minTimeSpent: 240, // 4 horas\n      skillsRequired: ['professional_communication', 'analysis', 'complex_grammar', 'nuanced_vocabulary'],\n      description: 'Fluidez profesional'\n    }\n  };\n\n  /**\n   * INICIALIZAR PROGRESO DE NUEVO USUARIO\n   */\n  async initializeUserProgress(userId: string, email: string, apiKey: string): Promise<UserProgress> {\n    const initialProgress: UserProgress = {\n      userId,\n      email,\n      currentLevel: 'A1',\n      totalExercises: 0,\n      totalCorrectAnswers: 0,\n      overallAccuracy: 0,\n      totalXP: 0,\n      totalTimeSpent: 0,\n      currentStreak: 0,\n      longestStreak: 0,\n      \n      levelProgress: {\n        A1: this.createInitialLevelStats(true),\n        A2: this.createInitialLevelStats(false),\n        B1: this.createInitialLevelStats(false),\n        B2: this.createInitialLevelStats(false)\n      },\n      \n      apiKey: this.encryptAPIKey(apiKey),\n      preferences: {\n        dailyGoal: 20,\n        soundEnabled: true,\n        animationsEnabled: true,\n        explanationLanguage: 'es',\n        difficultyPreference: 'adaptive'\n      },\n      \n      unlockedAchievements: [],\n      createdAt: new Date(),\n      lastActive: new Date()\n    };\n\n    await setDoc(doc(this.db, 'userProgress', userId), {\n      ...initialProgress,\n      createdAt: Timestamp.fromDate(initialProgress.createdAt),\n      lastActive: Timestamp.fromDate(initialProgress.lastActive)\n    });\n\n    return initialProgress;\n  }\n\n  /**\n   * ACTUALIZAR PROGRESO DESPUÉS DE SESIÓN\n   */\n  async updateProgress(userId: string, sessionResults: SessionResults): Promise<UserProgress> {\n    return await runTransaction(this.db, async (transaction) => {\n      const progressRef = doc(this.db, 'userProgress', userId);\n      const progressDoc = await transaction.get(progressRef);\n      \n      if (!progressDoc.exists()) {\n        throw new Error('User progress not found');\n      }\n\n      const currentProgress = this.convertFirestoreToProgress(progressDoc.data());\n      \n      // 1. ACTUALIZAR ESTADÍSTICAS GLOBALES\n      const newTotalExercises = currentProgress.totalExercises + sessionResults.totalAnswers;\n      const newTotalCorrect = currentProgress.totalCorrectAnswers + sessionResults.correctAnswers;\n      const newOverallAccuracy = newTotalCorrect / newTotalExercises;\n      \n      // 2. ACTUALIZAR PROGRESO DEL NIVEL ACTUAL\n      const currentLevel = currentProgress.currentLevel;\n      const levelStats = currentProgress.levelProgress[currentLevel];\n      \n      const updatedLevelStats: LevelStats = {\n        ...levelStats,\n        exercisesCompleted: levelStats.exercisesCompleted + sessionResults.totalAnswers,\n        correctAnswers: levelStats.correctAnswers + sessionResults.correctAnswers,\n        accuracy: (levelStats.correctAnswers + sessionResults.correctAnswers) / \n                 (levelStats.exercisesCompleted + sessionResults.totalAnswers),\n        xpEarned: levelStats.xpEarned + sessionResults.xpEarned,\n        timeSpent: levelStats.timeSpent + sessionResults.timeSpent,\n        sessionsCompleted: levelStats.sessionsCompleted + 1,\n        lastSession: new Date(),\n        averageTime: (levelStats.averageTime * levelStats.exercisesCompleted + \n                     sessionResults.timeSpent * 60 / sessionResults.totalAnswers) / \n                    (levelStats.exercisesCompleted + sessionResults.totalAnswers),\n        weakAreas: this.updateWeakAreas(levelStats.weakAreas, sessionResults.weakAreasIdentified),\n        strongAreas: this.updateStrongAreas(levelStats.strongAreas, sessionResults.skillsFocused, sessionResults.accuracy)\n      };\n\n      // 3. VERIFICAR LEVEL UP\n      const progressCalc = this.calculateProgress(currentLevel, updatedLevelStats);\n      let newLevel = currentLevel;\n      let updatedLevelProgress = { ...currentProgress.levelProgress };\n      \n      if (progressCalc.canLevelUp && currentLevel !== 'B2') {\n        newLevel = this.getNextLevel(currentLevel);\n        updatedLevelStats.isCompleted = true;\n        updatedLevelStats.completedAt = new Date();\n        \n        // Desbloquear siguiente nivel\n        updatedLevelProgress[newLevel].isUnlocked = true;\n        \n        console.log(`🎉 LEVEL UP: ${currentLevel} → ${newLevel}`);\n      }\n      \n      updatedLevelProgress[currentLevel] = updatedLevelStats;\n\n      // 4. CALCULAR STREAK\n      const today = new Date().toISOString().split('T')[0];\n      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];\n      const lastActiveDate = currentProgress.lastActive.toISOString().split('T')[0];\n      \n      let newStreak = currentProgress.currentStreak;\n      if (lastActiveDate === yesterday) {\n        newStreak += 1;\n      } else if (lastActiveDate !== today) {\n        newStreak = 1;\n      }\n\n      // 5. PROGRESO ACTUALIZADO\n      const updatedProgress: UserProgress = {\n        ...currentProgress,\n        currentLevel: newLevel,\n        totalExercises: newTotalExercises,\n        totalCorrectAnswers: newTotalCorrect,\n        overallAccuracy: newOverallAccuracy,\n        totalXP: currentProgress.totalXP + sessionResults.xpEarned,\n        totalTimeSpent: currentProgress.totalTimeSpent + sessionResults.timeSpent,\n        currentStreak: newStreak,\n        longestStreak: Math.max(currentProgress.longestStreak, newStreak),\n        levelProgress: updatedLevelProgress,\n        lastActive: new Date(),\n        ...(progressCalc.canLevelUp && { lastLevelUp: new Date() })\n      };\n\n      // 6. GUARDAR EN FIREBASE\n      transaction.update(progressRef, {\n        ...updatedProgress,\n        lastActive: Timestamp.fromDate(updatedProgress.lastActive),\n        ...(updatedProgress.lastLevelUp && { \n          lastLevelUp: Timestamp.fromDate(updatedProgress.lastLevelUp) \n        }),\n        'levelProgress.A1.lastSession': updatedProgress.levelProgress.A1.lastSession ? \n          Timestamp.fromDate(updatedProgress.levelProgress.A1.lastSession) : null,\n        'levelProgress.A2.lastSession': updatedProgress.levelProgress.A2.lastSession ? \n          Timestamp.fromDate(updatedProgress.levelProgress.A2.lastSession) : null,\n        'levelProgress.B1.lastSession': updatedProgress.levelProgress.B1.lastSession ? \n          Timestamp.fromDate(updatedProgress.levelProgress.B1.lastSession) : null,\n        'levelProgress.B2.lastSession': updatedProgress.levelProgress.B2.lastSession ? \n          Timestamp.fromDate(updatedProgress.levelProgress.B2.lastSession) : null,\n      });\n\n      // 7. GUARDAR PROGRESO DIARIO\n      await this.saveDailyProgress(userId, sessionResults, updatedProgress);\n\n      return updatedProgress;\n    });\n  }\n\n  /**\n   * OBTENER PROGRESO DEL USUARIO\n   */\n  async getUserProgress(userId: string): Promise<UserProgress | null> {\n    const progressDoc = await getDoc(doc(this.db, 'userProgress', userId));\n    \n    if (!progressDoc.exists()) {\n      return null;\n    }\n\n    return this.convertFirestoreToProgress(progressDoc.data());\n  }\n\n  /**\n   * CALCULAR PROGRESO HACIA SIGUIENTE NIVEL\n   */\n  calculateProgress(level: Level, stats: LevelStats): ProgressCalculation {\n    const requirements = ProgressService.LEVEL_REQUIREMENTS[level];\n    \n    const exerciseProgress = Math.min(1, stats.exercisesCompleted / requirements.minExercises);\n    const accuracyProgress = Math.min(1, stats.accuracy / requirements.minAccuracy);\n    const sessionProgress = Math.min(1, stats.sessionsCompleted / requirements.minSessions);\n    const timeProgress = Math.min(1, stats.timeSpent / requirements.minTimeSpent);\n    \n    // Progreso general (promedio ponderado)\n    const progressPercentage = Math.round(\n      (exerciseProgress * 0.4 + accuracyProgress * 0.3 + sessionProgress * 0.2 + timeProgress * 0.1) * 100\n    );\n    \n    // Verificar si puede subir de nivel\n    const canLevelUp = \n      stats.exercisesCompleted >= requirements.minExercises &&\n      stats.accuracy >= requirements.minAccuracy &&\n      stats.sessionsCompleted >= requirements.minSessions &&\n      stats.timeSpent >= requirements.minTimeSpent;\n\n    // Identificar qué lo bloquea\n    const blockedBy: string[] = [];\n    if (stats.exercisesCompleted < requirements.minExercises) {\n      blockedBy.push(`Ejercicios: ${stats.exercisesCompleted}/${requirements.minExercises}`);\n    }\n    if (stats.accuracy < requirements.minAccuracy) {\n      blockedBy.push(`Precisión: ${Math.round(stats.accuracy * 100)}%/${Math.round(requirements.minAccuracy * 100)}%`);\n    }\n    if (stats.sessionsCompleted < requirements.minSessions) {\n      blockedBy.push(`Sesiones: ${stats.sessionsCompleted}/${requirements.minSessions}`);\n    }\n    if (stats.timeSpent < requirements.minTimeSpent) {\n      blockedBy.push(`Tiempo: ${stats.timeSpent}/${requirements.minTimeSpent} min`);\n    }\n\n    return {\n      canLevelUp,\n      progressPercentage,\n      nextLevel: this.getNextLevel(level),\n      requirements,\n      currentStats: stats,\n      blockedBy,\n      estimatedTimeToLevelUp: this.calculateEstimatedTime(stats, requirements)\n    };\n  }\n\n  /**\n   * GUARDAR PROGRESO DIARIO\n   */\n  private async saveDailyProgress(userId: string, sessionResults: SessionResults, userProgress: UserProgress): Promise<void> {\n    const today = new Date().toISOString().split('T')[0];\n    const dailyRef = doc(this.db, 'dailyProgress', `${userId}_${today}`);\n    \n    const dailyDoc = await getDoc(dailyRef);\n    \n    const dailyProgress: DailyProgress = {\n      userId,\n      date: today,\n      exercisesCompleted: (dailyDoc.exists() ? dailyDoc.data().exercisesCompleted : 0) + sessionResults.totalAnswers,\n      correctAnswers: (dailyDoc.exists() ? dailyDoc.data().correctAnswers : 0) + sessionResults.correctAnswers,\n      accuracy: 0, // Se calculará después\n      xpEarned: (dailyDoc.exists() ? dailyDoc.data().xpEarned : 0) + sessionResults.xpEarned,\n      timeSpent: (dailyDoc.exists() ? dailyDoc.data().timeSpent : 0) + sessionResults.timeSpent,\n      sessionsCompleted: (dailyDoc.exists() ? dailyDoc.data().sessionsCompleted : 0) + 1,\n      goalMet: false, // Se calculará después\n      streak: userProgress.currentStreak,\n      level: userProgress.currentLevel\n    };\n\n    dailyProgress.accuracy = dailyProgress.correctAnswers / dailyProgress.exercisesCompleted;\n    dailyProgress.goalMet = dailyProgress.exercisesCompleted >= userProgress.preferences.dailyGoal;\n\n    await setDoc(dailyRef, dailyProgress, { merge: true });\n  }\n\n  /**\n   * UTILIDADES PRIVADAS\n   */\n  private createInitialLevelStats(isUnlocked: boolean): LevelStats {\n    return {\n      exercisesCompleted: 0,\n      correctAnswers: 0,\n      accuracy: 0,\n      xpEarned: 0,\n      timeSpent: 0,\n      sessionsCompleted: 0,\n      isUnlocked,\n      isCompleted: false,\n      weakAreas: [],\n      strongAreas: [],\n      averageTime: 0\n    };\n  }\n\n  private getNextLevel(currentLevel: Level): Level {\n    const levels: Level[] = ['A1', 'A2', 'B1', 'B2'];\n    const currentIndex = levels.indexOf(currentLevel);\n    return levels[Math.min(currentIndex + 1, levels.length - 1)];\n  }\n\n  private updateWeakAreas(current: string[], newWeak: string[]): string[] {\n    const combined = [...current, ...newWeak];\n    const counts = combined.reduce((acc, area) => {\n      acc[area] = (acc[area] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return Object.entries(counts)\n      .filter(([_, count]) => count >= 2)\n      .map(([area, _]) => area)\n      .slice(0, 5); // Máximo 5 áreas débiles\n  }\n\n  private updateStrongAreas(current: string[], focused: string[], accuracy: number): string[] {\n    if (accuracy >= 0.85) {\n      const combined = [...current, ...focused];\n      return Array.from(new Set(combined)).slice(0, 5);\n    }\n    return current;\n  }\n\n  private calculateEstimatedTime(stats: LevelStats, requirements: LevelRequirements): number {\n    const exercisesNeeded = Math.max(0, requirements.minExercises - stats.exercisesCompleted);\n    const averageTimePerExercise = stats.averageTime || 60; // 1 minuto default\n    return exercisesNeeded * averageTimePerExercise / 60; // convertir a minutos\n  }\n\n  private encryptAPIKey(apiKey: string): string {\n    return btoa(apiKey); // Base64 básico - usar crypto más robusto en producción\n  }\n\n  private decryptAPIKey(encryptedKey: string): string {\n    return atob(encryptedKey);\n  }\n\n  private convertFirestoreToProgress(data: any): UserProgress {\n    return {\n      ...data,\n      createdAt: data.createdAt.toDate(),\n      lastActive: data.lastActive.toDate(),\n      lastLevelUp: data.lastLevelUp?.toDate(),\n      levelProgress: {\n        A1: {\n          ...data.levelProgress.A1,\n          completedAt: data.levelProgress.A1.completedAt?.toDate(),\n          lastSession: data.levelProgress.A1.lastSession?.toDate()\n        },\n        A2: {\n          ...data.levelProgress.A2,\n          completedAt: data.levelProgress.A2.completedAt?.toDate(),\n          lastSession: data.levelProgress.A2.lastSession?.toDate()\n        },\n        B1: {\n          ...data.levelProgress.B1,\n          completedAt: data.levelProgress.B1.completedAt?.toDate(),\n          lastSession: data.levelProgress.B1.lastSession?.toDate()\n        },\n        B2: {\n          ...data.levelProgress.B2,\n          completedAt: data.levelProgress.B2.completedAt?.toDate(),\n          lastSession: data.levelProgress.B2.lastSession?.toDate()\n        }\n      }\n    };\n  }\n}","/**\n * PANTALLA DE AUTENTICACIÓN - ENGLISH MASTER APP\n * Login/Register con Google OAuth y Email\n */\n\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { \n  signInWithPopup, \n  GoogleAuthProvider, \n  signInWithEmailAndPassword, \n  createUserWithEmailAndPassword,\n  sendPasswordResetEmail\n} from 'firebase/auth';\nimport { \n  Mail, \n  Lock, \n  Eye, \n  EyeOff, \n  AlertCircle, \n  CheckCircle,\n  Sparkles\n} from 'lucide-react';\nimport toast from 'react-hot-toast';\n\nimport { auth } from '../../services/firebase/config';\n\nexport const AuthScreen: React.FC = () => {\n  const [isLogin, setIsLogin] = useState(true);\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const googleProvider = new GoogleAuthProvider();\n  googleProvider.addScope('email');\n  googleProvider.addScope('profile');\n\n  const handleGoogleSignIn = async () => {\n    try {\n      setLoading(true);\n      setError('');\n      \n      const result = await signInWithPopup(auth, googleProvider);\n      \n      console.log('✅ Google sign in successful:', result.user.email);\n      toast.success(`¡Bienvenido ${result.user.displayName || result.user.email}!`);\n      \n    } catch (error: any) {\n      console.error('❌ Google sign in error:', error);\n      setError('Error al iniciar sesión con Google');\n      toast.error('Error al iniciar sesión con Google');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEmailAuth = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!email || !password) {\n      setError('Por favor completa todos los campos');\n      return;\n    }\n\n    if (password.length < 6) {\n      setError('La contraseña debe tener al menos 6 caracteres');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError('');\n\n      if (isLogin) {\n        const result = await signInWithEmailAndPassword(auth, email, password);\n        console.log('✅ Email sign in successful:', result.user.email);\n        toast.success('¡Sesión iniciada correctamente!');\n      } else {\n        const result = await createUserWithEmailAndPassword(auth, email, password);\n        console.log('✅ Account created successfully:', result.user.email);\n        toast.success('¡Cuenta creada exitosamente!');\n      }\n      \n    } catch (error: any) {\n      console.error('❌ Email auth error:', error);\n      \n      const errorMessages: Record<string, string> = {\n        'auth/user-not-found': 'Usuario no encontrado',\n        'auth/wrong-password': 'Contraseña incorrecta',\n        'auth/email-already-in-use': 'Este email ya está registrado',\n        'auth/weak-password': 'La contraseña es muy débil',\n        'auth/invalid-email': 'Email inválido',\n        'auth/too-many-requests': 'Demasiados intentos. Intenta más tarde'\n      };\n      \n      setError(errorMessages[error.code] || 'Error de autenticación');\n      toast.error(errorMessages[error.code] || 'Error de autenticación');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleForgotPassword = async () => {\n    if (!email) {\n      setError('Ingresa tu email para recuperar la contraseña');\n      return;\n    }\n\n    try {\n      await sendPasswordResetEmail(auth, email);\n      toast.success('Email de recuperación enviado');\n    } catch (error: any) {\n      toast.error('Error enviando email de recuperación');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"max-w-md w-full\"\n      >\n        <div className=\"bg-white rounded-2xl shadow-2xl p-8 border border-gray-200/50\">\n          \n          {/* Header */}\n          <div className=\"text-center mb-8\">\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ delay: 0.2, type: \"spring\" }}\n              className=\"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4\"\n            >\n              <span className=\"text-white font-bold text-xl\">EM</span>\n            </motion.div>\n            \n            <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2\">\n              English Master\n            </h1>\n            \n            <p className=\"text-gray-600\">\n              {isLogin ? 'Inicia sesión en tu cuenta' : 'Crea tu cuenta nueva'}\n            </p>\n          </div>\n\n          {/* Google Sign In */}\n          <motion.button\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.3 }}\n            onClick={handleGoogleSignIn}\n            disabled={loading}\n            className=\"w-full flex items-center justify-center space-x-3 p-4 border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50 mb-6\"\n          >\n            <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n              <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n              <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n              <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n              <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n            </svg>\n            <span className=\"font-medium text-gray-700\">\n              {isLogin ? 'Continuar con Google' : 'Registrarse con Google'}\n            </span>\n          </motion.button>\n\n          {/* Divider */}\n          <div className=\"flex items-center my-6\">\n            <div className=\"flex-1 border-t border-gray-300\"></div>\n            <span className=\"px-4 text-sm text-gray-500\">o</span>\n            <div className=\"flex-1 border-t border-gray-300\"></div>\n          </div>\n\n          {/* Email Form */}\n          <form onSubmit={handleEmailAuth} className=\"space-y-4\">\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.4 }}\n            >\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email\n              </label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => {\n                    setEmail(e.target.value);\n                    setError('');\n                  }}\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                  placeholder=\"tu@email.com\"\n                  disabled={loading}\n                />\n              </div>\n            </motion.div>\n\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.5 }}\n            >\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Contraseña\n              </label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                <input\n                  type={showPassword ? 'text' : 'password'}\n                  value={password}\n                  onChange={(e) => {\n                    setPassword(e.target.value);\n                    setError('');\n                  }}\n                  className=\"w-full pl-10 pr-10 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                  placeholder=\"••••••••\"\n                  disabled={loading}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n                >\n                  {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n                </button>\n              </div>\n            </motion.div>\n\n            {/* Error Message */}\n            {error && (\n              <motion.div\n                initial={{ opacity: 0, y: -10 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"p-3 bg-red-50 border border-red-200 rounded-xl flex items-start space-x-2\"\n              >\n                <AlertCircle className=\"w-5 h-5 text-red-500 mt-0.5\" />\n                <p className=\"text-red-700 text-sm\">{error}</p>\n              </motion.div>\n            )}\n\n            {/* Submit Button */}\n            <motion.button\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.6 }}\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50\"\n            >\n              {loading ? (\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <motion.div\n                    animate={{ rotate: 360 }}\n                    transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                    className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full\"\n                  />\n                  <span>{isLogin ? 'Iniciando sesión...' : 'Creando cuenta...'}</span>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-center space-x-2\">\n                  {isLogin ? <CheckCircle className=\"w-5 h-5\" /> : <Sparkles className=\"w-5 h-5\" />}\n                  <span>{isLogin ? 'Iniciar Sesión' : 'Crear Cuenta'}</span>\n                </div>\n              )}\n            </motion.button>\n          </form>\n\n          {/* Footer */}\n          <div className=\"mt-6 text-center space-y-3\">\n            {isLogin && (\n              <button\n                onClick={handleForgotPassword}\n                className=\"text-sm text-blue-600 hover:text-blue-800 transition-colors\"\n                disabled={loading}\n              >\n                ¿Olvidaste tu contraseña?\n              </button>\n            )}\n            \n            <div className=\"text-sm text-gray-600\">\n              {isLogin ? '¿No tienes cuenta?' : '¿Ya tienes cuenta?'}\n              {' '}\n              <button\n                onClick={() => {\n                  setIsLogin(!isLogin);\n                  setError('');\n                }}\n                className=\"text-blue-600 hover:text-blue-800 font-medium transition-colors\"\n                disabled={loading}\n              >\n                {isLogin ? 'Crear cuenta' : 'Iniciar sesión'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </motion.div>\n    </div>\n  );\n};","/**\n * AI PROMPTS ESPECÍFICOS POR NIVEL - PEDAGOGÍA CORRECTA\n * English Master App - Sistema de IA Inteligente\n */\n\nexport interface ExercisePromptParams {\n  userId: string;\n  level: 'A1' | 'A2' | 'B1' | 'B2';\n  weakAreas?: string[];\n  completedExercises: number;\n  sessionNumber: number;\n}\n\nexport class PromptTemplates {\n  \n  /**\n   * PROMPT A1 - CRÍTICO: ESPAÑOL → INGLÉS (SUPERVIVENCIA)\n   * Principiantes absolutos que NO SABEN INGLÉS\n   */\n  static getA1Prompt(params: ExercisePromptParams): string {\n    return `ERES UN PROFESOR DE INGLÉS PARA PRINCIPIANTES ABSOLUTOS HISPANOHABLANTES.\n\nCONTEXTO CRÍTICO: \n- El estudiante NO SABE INGLÉS. Es su primera vez aprendiendo.\n- Ha completado ${params.completedExercises} ejercicios\n- Sesión número: ${params.sessionNumber}\n- Áreas débiles: ${params.weakAreas?.join(', ') || 'ninguna identificada'}\n\n🎯 REGLAS PEDAGÓGICAS ESTRICTAS:\n1. TODAS las situaciones y preguntas deben estar en ESPAÑOL claro y simple\n2. TODAS las opciones de respuesta están en INGLÉS (lo que debe aprender)\n3. SOLO situaciones de supervivencia real y lógica social básica\n4. Máximo 4 opciones por pregunta\n5. Una sola respuesta obviamente correcta por lógica social\n\n✅ SITUACIONES PERMITIDAS ÚNICAMENTE:\n\n**SALUDOS Y CORTESÍA (25%)**:\n- \"Te encuentras con un vecino y te dice 'Hello'\" → [\"Hello\", \"Goodbye\", \"Please\", \"Sorry\"]\n- \"Alguien te saluda con 'Good morning'\" → [\"Good morning\", \"Good night\", \"Thank you\", \"Excuse me\"]\n\n**AGRADECIMIENTOS Y RESPUESTAS (25%)**:\n- \"Te dan comida en un restaurante\" → [\"Thank you\", \"You're welcome\", \"Hello\", \"Goodbye\"]\n- \"Alguien te dice 'Thank you'\" → [\"You're welcome\", \"Thank you\", \"Hello\", \"Sorry\"]\n\n**NECESIDADES BÁSICAS (25%)**:\n- \"Tienes sed y necesitas agua\" → [\"Can I have water?\", \"Hello\", \"Thank you\", \"Goodbye\"]\n- \"Tienes hambre\" → [\"I'm hungry\", \"I'm tired\", \"Hello\", \"Goodbye\"]\n- \"Necesitas ir al baño\" → [\"Where is the bathroom?\", \"Hello\", \"Thank you\", \"Goodbye\"]\n\n**PRESENTACIONES E INFORMACIÓN (25%)**:\n- \"Te preguntan cómo te llamas\" → [\"My name is...\", \"Hello\", \"Thank you\", \"Goodbye\"]\n- \"Te preguntan de dónde eres\" → [\"I'm from...\", \"Hello\", \"Thank you\", \"My name is\"]\n- \"Estás perdido y necesitas ayuda\" → [\"Excuse me\", \"Thank you\", \"Goodbye\", \"Hello\"]\n\n🚨 LÓGICA SOCIAL OBLIGATORIA:\n- Si alguien saluda → Saludar de vuelta\n- Si alguien da algo → Agradecer (\"Thank you\")\n- Si alguien agradece → Responder cortésmente (\"You're welcome\")\n- Si necesitas algo → Pedirlo educadamente\n- Si cometes error → Disculparse\n- Si te preguntan algo personal → Responder directamente\n\n❌ PROHIBIDO ABSOLUTAMENTE:\n- Situaciones abstractas o complejas\n- Gramática avanzada (present perfect, conditionals)\n- Vocabulario no esencial para supervivencia\n- Preguntas EN INGLÉS (deben ser en ESPAÑOL)\n- Múltiples respuestas correctas\n- Ejercicios que requieran conocimiento previo\n- Situaciones irreales o poco comunes\n\nFORMATO JSON OBLIGATORIO:\n{\n  \"exercises\": [\n    {\n      \"id\": \"a1_survival_001\",\n      \"type\": \"multiple_choice\",\n      \"situation\": \"Te encuentras con un compañero de trabajo en el pasillo y te dice 'Hello'\",\n      \"question\": \"¿Qué debes responder para ser educado?\",\n      \"options\": [\"Hello\", \"You're welcome\", \"I'm sorry\", \"Goodbye\"],\n      \"correct_answer\": 0,\n      \"explanation\": \"Cuando alguien te saluda con 'Hello', debes saludar de vuelta. Es cortesía básica responder el saludo.\",\n      \"level\": \"A1\",\n      \"skill_focus\": \"social_greetings\",\n      \"difficulty\": 0.2\n    }\n  ]\n}\n\nGENERAR EXACTAMENTE 8 EJERCICIOS únicos, diversos y pedagógicamente progresivos para SUPERVIVENCIA BÁSICA.`;\n  }\n\n  /**\n   * PROMPT A2 - COMUNICACIÓN COTIDIANA\n   * 70% español, 30% inglés simple\n   */\n  static getA2Prompt(params: ExercisePromptParams): string {\n    return `ERES UN PROFESOR DE INGLÉS PARA ESTUDIANTES ELEMENTALES HISPANOHABLANTES.\n\nCONTEXTO: \n- El estudiante sabe inglés básico de supervivencia (A1 completado)\n- Puede entender algunas preguntas simples en inglés\n- Ha completado ${params.completedExercises} ejercicios A2\n- Áreas débiles: ${params.weakAreas?.join(', ') || 'ninguna identificada'}\n\n🎯 OBJETIVO A2: Comunicación en situaciones cotidianas simples\n\nMETODOLOGÍA: 70% preguntas en ESPAÑOL, 30% en inglés MUY simple\n\n✅ SITUACIONES A2 OBLIGATORIAS:\n\n**RUTINAS DIARIAS (25%)**:\n- \"¿Cómo dices que vas al trabajo todos los días?\" → [\"I go to work every day\", \"I went to work\", \"I will go to work\", \"I am going to work\"]\n- \"What do you do in the morning?\" → [\"I have breakfast\", \"I had breakfast\", \"I will have breakfast\", \"I am having breakfast\"]\n\n**EXPERIENCIAS PASADAS (25%)**:\n- \"¿Cómo dices que fuiste al cine ayer?\" → [\"I went to the movies yesterday\", \"I go to movies\", \"I will go to movies\", \"I am going to movies\"]\n- \"What did you do last weekend?\" → [\"I visited my family\", \"I visit my family\", \"I will visit my family\", \"I am visiting my family\"]\n\n**PLANES FUTUROS (25%)**:\n- \"¿Cómo expresas que vas a estudiar mañana?\" → [\"I'm going to study tomorrow\", \"I study tomorrow\", \"I studied tomorrow\", \"I have studied tomorrow\"]\n- \"What are your plans for tonight?\" → [\"I'm going to watch TV\", \"I watch TV\", \"I watched TV\", \"I have watched TV\"]\n\n**PREFERENCIAS Y OPINIONES SIMPLES (25%)**:\n- \"¿Cómo dices que te gusta la pizza?\" → [\"I like pizza\", \"I liked pizza\", \"I will like pizza\", \"I am liking pizza\"]\n- \"Do you prefer coffee or tea?\" → [\"I prefer coffee\", \"I preferred coffee\", \"I will prefer coffee\", \"I am preferring coffee\"]\n\nGRAMÁTICA A2 FOCUS:\n- Present Simple vs Past Simple\n- Going to future\n- Basic present perfect\n- Like/prefer/want + noun/infinitive\n\nFORMATO JSON: [igual estructura que A1 pero con \"level\": \"A2\"]\n\nGENERAR 8 EJERCICIOS A2 para COMUNICACIÓN COTIDIANA.`;\n  }\n\n  /**\n   * PROMPT B1 - INDEPENDENCIA COMUNICATIVA\n   * 30% español, 70% inglés\n   */\n  static getB1Prompt(params: ExercisePromptParams): string {\n    return `ERES UN PROFESOR DE INGLÉS PARA ESTUDIANTES INTERMEDIOS HISPANOHABLANTES.\n\nCONTEXTO:\n- El estudiante puede comunicarse en situaciones básicas (A1-A2 completado)\n- Entiende la mayoría de preguntas en inglés\n- Necesita fluidez en situaciones más complejas\n- Ha completado ${params.completedExercises} ejercicios B1\n\n🎯 OBJETIVO B1: Comunicación independiente y resolución de problemas\n\nMETODOLOGÍA: 30% preguntas en español, 70% en inglés\n\n✅ SITUACIONES B1 OBLIGATORIAS:\n\n**TRABAJO Y PROFESIÓN (25%)**:\n- \"In a job interview, they ask 'Why do you want this job?' Best response:\" → [\"I believe I can contribute to the team\", \"I need money\", \"I like jobs\", \"This is a good company\"]\n- \"¿Cómo pides un día libre en el trabajo?\" → [\"Could I take tomorrow off?\", \"I no work tomorrow\", \"Tomorrow I don't go\", \"I want day free\"]\n\n**PROBLEMAS Y SOLUCIONES (25%)**:\n- \"Your internet isn't working. How do you explain this to tech support?\" → [\"I'm having trouble with my internet connection\", \"My internet no work\", \"Internet is bad\", \"I don't like internet\"]\n- \"If you had more time, what would you do?\" → [\"I would travel more\", \"I will travel more\", \"I travel more\", \"I am traveling more\"]\n\n**OPINIONES Y ARGUMENTOS (25%)**:\n- \"How do you politely disagree with someone?\" → [\"I see your point, but I think...\", \"You are wrong\", \"That's stupid\", \"No, no, no\"]\n- \"¿Cómo expresas tu opinión sobre las redes sociales?\" → [\"I think social media is useful because...\", \"Social media good\", \"I like Facebook\", \"Internet is OK\"]\n\n**SITUACIONES HIPOTÉTICAS (25%)**:\n- \"What would you do if you won the lottery?\" → [\"I would buy a house\", \"I will buy a house\", \"I buy a house\", \"I am buying a house\"]\n- \"If you could live anywhere, where would you go?\" → [\"I would live in Spain\", \"I will live in Spain\", \"I live in Spain\", \"I am living in Spain\"]\n\nGRAMÁTICA B1 FOCUS:\n- Conditionals (would, could, should)\n- Present perfect vs Past simple\n- Modal verbs for advice/possibility\n- Complex sentence structures\n\nGENERAR 8 EJERCICIOS B1 para INDEPENDENCIA COMUNICATIVA.`;\n  }\n\n  /**\n   * PROMPT B2 - FLUIDEZ PROFESIONAL\n   * 100% inglés avanzado\n   */\n  static getB2Prompt(params: ExercisePromptParams): string {\n    return `YOU ARE AN ADVANCED ENGLISH TEACHER FOR SPANISH SPEAKERS AT B2 LEVEL.\n\nCONTEXT:\n- Student has intermediate communication skills (A1-B1 completed)\n- Can handle complex conversations and professional situations\n- Needs refinement and sophisticated language use\n- Has completed ${params.completedExercises} B2 exercises\n\n🎯 OBJECTIVE B2: Sophisticated communication and professional fluency\n\nMETHODOLOGY: 100% English - advanced situations and nuanced language\n\n✅ MANDATORY B2 SITUATIONS:\n\n**PROFESSIONAL COMMUNICATION (25%)**:\n- \"In a business meeting, how do you present a counterargument?\" → [\"While I understand your perspective, I'd like to propose an alternative approach\", \"I think you're wrong\", \"That's not good\", \"I don't agree with you\"]\n- \"How do you diplomatically suggest changes to a colleague's proposal?\" → [\"Have you considered incorporating...\", \"Your idea is bad\", \"Change this please\", \"I don't like this\"]\n\n**SOPHISTICATED VOCABULARY (25%)**:\n- \"Which word best describes someone who adapts easily to change?\" → [\"versatile\", \"good\", \"nice\", \"happy\"]\n- \"The new policy has had _____ consequences for our department.\" → [\"far-reaching\", \"big\", \"many\", \"some\"]\n\n**COMPLEX GRAMMAR (25%)**:\n- \"Had I known about the traffic, I _____ earlier.\" → [\"would have left\", \"will leave\", \"leave\", \"left\"]\n- \"Which sentence uses the subjunctive correctly?\" → [\"I suggest that he be more careful\", \"I suggest that he is more careful\", \"I suggest he careful\", \"I suggest he be careful\"]\n\n**ANALYSIS AND CRITIQUE (25%)**:\n- \"How do you analyze the pros and cons of remote work?\" → [\"While remote work offers flexibility, it may impact collaboration\", \"Remote work good and bad\", \"I like work from home\", \"Office better than home\"]\n- \"Express a nuanced opinion about social media:\" → [\"Social media serves as a double-edged sword in modern communication\", \"Social media good and bad\", \"I like Facebook\", \"Internet is useful\"]\n\nGRAMMAR B2 FOCUS:\n- Advanced conditionals (3rd conditional, mixed conditionals)\n- Subjunctive mood\n- Sophisticated connectors and discourse markers\n- Nuanced modal verbs\n- Complex passive constructions\n\nGENERATE 8 B2 EXERCISES for PROFESSIONAL FLUENCY.`;\n  }\n\n  /**\n   * Obtener prompt específico por nivel\n   */\n  static getPromptForLevel(level: 'A1' | 'A2' | 'B1' | 'B2', params: ExercisePromptParams): string {\n    switch (level) {\n      case 'A1': return this.getA1Prompt(params);\n      case 'A2': return this.getA2Prompt(params);\n      case 'B1': return this.getB1Prompt(params);\n      case 'B2': return this.getB2Prompt(params);\n      default: return this.getA1Prompt(params);\n    }\n  }\n}","/**\n * GEMINI AI SERVICE - GENERACIÓN INTELIGENTE DE EJERCICIOS\n * English Master App - Sistema de IA con Validación Pedagógica\n */\n\nimport { GoogleGenerativeAI } from '@google/generative-ai';\nimport { PromptTemplates, ExercisePromptParams } from './PromptTemplates';\nimport { Level } from '../../types/progress';\n\nexport interface Exercise {\n  id: string;\n  type: 'multiple_choice' | 'fill_blank' | 'conversation' | 'listening';\n  situation: string;\n  question: string;\n  options: string[];\n  correct_answer: number;\n  explanation: string;\n  level: Level;\n  skill_focus: string;\n  difficulty: number; // 0-1 scale\n}\n\nexport interface ExerciseValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n  pedagogicalScore: number; // 0-1\n}\n\nexport class GeminiService {\n  private genAI: GoogleGenerativeAI;\n\n  constructor(apiKey: string) {\n    this.genAI = new GoogleGenerativeAI(apiKey);\n  }\n\n  /**\n   * GENERAR EJERCICIOS ESPECÍFICOS POR NIVEL\n   */\n  async generateExercises(params: ExercisePromptParams): Promise<Exercise[]> {\n    try {\n      console.log(`🤖 Generando ejercicios ${params.level} para usuario ${params.userId}`);\n      \n      const prompt = PromptTemplates.getPromptForLevel(params.level, params);\n      \n      const model = this.genAI.getGenerativeModel({\n        model: \"gemini-1.5-flash\",\n        generationConfig: {\n          temperature: 0.7,\n          topP: 0.8,\n          topK: 40,\n          maxOutputTokens: 2048,\n        }\n      });\n\n      const result = await model.generateContent(prompt);\n      const response = result.response;\n      const text = response.text();\n\n      // Parsear respuesta JSON\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No se pudo extraer JSON de la respuesta de IA');\n      }\n\n      const exerciseData = JSON.parse(jsonMatch[0]);\n      \n      if (!exerciseData.exercises || !Array.isArray(exerciseData.exercises)) {\n        throw new Error('Formato de ejercicios inválido');\n      }\n\n      // Validar y procesar ejercicios\n      const validatedExercises: Exercise[] = [];\n      \n      for (let i = 0; i < exerciseData.exercises.length; i++) {\n        const exercise = exerciseData.exercises[i];\n        \n        // Validación pedagógica\n        const validation = this.validateExercise(exercise, params.level);\n        \n        if (validation.isValid) {\n          // Generar ID único y procesar ejercicio\n          const processedExercise: Exercise = {\n            ...exercise,\n            id: `${params.level.toLowerCase()}_${Date.now()}_${i}`,\n            correct_answer: typeof exercise.correct_answer === 'string' ? \n              exercise.options.indexOf(exercise.correct_answer) : exercise.correct_answer,\n            difficulty: this.calculateDifficulty(exercise, params.level)\n          };\n\n          // Mezclar opciones manteniendo respuesta correcta\n          const shuffledExercise = this.shuffleOptions(processedExercise);\n          validatedExercises.push(shuffledExercise);\n          \n          console.log(`✅ Ejercicio ${i + 1} validado: ${exercise.skill_focus}`);\n        } else {\n          console.warn(`❌ Ejercicio ${i + 1} rechazado:`, validation.errors);\n        }\n      }\n\n      if (validatedExercises.length === 0) {\n        throw new Error('No se generaron ejercicios válidos');\n      }\n\n      console.log(`🎯 ${validatedExercises.length} ejercicios ${params.level} generados exitosamente`);\n      return validatedExercises;\n\n    } catch (error) {\n      console.error('❌ Error generando ejercicios:', error);\n      \n      // Fallback a ejercicios de emergencia\n      return this.generateEmergencyExercises(params.level);\n    }\n  }\n\n  /**\n   * VALIDACIÓN PEDAGÓGICA ESTRICTA\n   */\n  private validateExercise(exercise: any, level: Level): ExerciseValidationResult {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    let pedagogicalScore = 1.0;\n\n    // Validaciones básicas de estructura\n    if (!exercise.question || typeof exercise.question !== 'string') {\n      errors.push('Pregunta faltante o inválida');\n    }\n\n    if (!exercise.options || !Array.isArray(exercise.options) || exercise.options.length !== 4) {\n      errors.push('Debe tener exactamente 4 opciones');\n    }\n\n    if (typeof exercise.correct_answer !== 'number' && typeof exercise.correct_answer !== 'string') {\n      errors.push('Respuesta correcta inválida');\n    }\n\n    if (!exercise.explanation || typeof exercise.explanation !== 'string') {\n      errors.push('Explicación faltante');\n    }\n\n    // Validaciones específicas por nivel\n    if (level === 'A1') {\n      const validation = this.validateA1Exercise(exercise);\n      errors.push(...validation.errors);\n      warnings.push(...validation.warnings);\n      pedagogicalScore *= validation.score;\n    } else if (level === 'A2') {\n      const validation = this.validateA2Exercise(exercise);\n      errors.push(...validation.errors);\n      warnings.push(...validation.warnings);\n      pedagogicalScore *= validation.score;\n    }\n\n    // Validar lógica social básica\n    const socialValidation = this.validateSocialLogic(exercise);\n    if (!socialValidation.isValid) {\n      errors.push(...socialValidation.errors);\n      pedagogicalScore *= 0.5;\n    }\n\n    // Validar diversidad de opciones\n    const diversityValidation = this.validateOptionDiversity(exercise.options);\n    if (!diversityValidation.isValid) {\n      warnings.push(...diversityValidation.warnings);\n      pedagogicalScore *= 0.9;\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      warnings,\n      pedagogicalScore\n    };\n  }\n\n  /**\n   * VALIDACIÓN ESPECÍFICA A1 - CRÍTICA\n   */\n  private validateA1Exercise(exercise: any): { errors: string[], warnings: string[], score: number } {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    let score = 1.0;\n\n    // Verificar que la pregunta esté en español\n    const questionLanguage = this.detectLanguage(exercise.question);\n    if (questionLanguage !== 'spanish') {\n      errors.push('A1: La pregunta debe estar en ESPAÑOL');\n      score *= 0.1;\n    }\n\n    // Verificar que las opciones estén en inglés\n    const optionsInEnglish = exercise.options.every((option: string) => {\n      const lang = this.detectLanguage(option);\n      return lang === 'english';\n    });\n\n    if (!optionsInEnglish) {\n      errors.push('A1: Todas las opciones deben estar en INGLÉS');\n      score *= 0.3;\n    }\n\n    // Verificar situaciones de supervivencia\n    const isSurvivalSituation = this.isSurvivalSituation(exercise.situation || exercise.question);\n    if (!isSurvivalSituation) {\n      errors.push('A1: Debe ser una situación de supervivencia básica');\n      score *= 0.5;\n    }\n\n    // Verificar vocabulario básico\n    const hasAdvancedVocabulary = this.hasAdvancedVocabulary(exercise.options.join(' '));\n    if (hasAdvancedVocabulary) {\n      warnings.push('A1: Contiene vocabulario avanzado');\n      score *= 0.8;\n    }\n\n    return { errors, warnings, score };\n  }\n\n  /**\n   * VALIDACIÓN ESPECÍFICA A2\n   */\n  private validateA2Exercise(exercise: any): { errors: string[], warnings: string[], score: number } {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    let score = 1.0;\n\n    // A2 puede tener 70% español, 30% inglés\n    const questionLanguage = this.detectLanguage(exercise.question);\n    if (questionLanguage === 'unknown') {\n      warnings.push('A2: Idioma de pregunta no detectado claramente');\n      score *= 0.9;\n    }\n\n    // Verificar gramática apropiada para A2\n    const hasA2Grammar = this.hasA2Grammar(exercise.question + ' ' + exercise.options.join(' '));\n    if (!hasA2Grammar) {\n      warnings.push('A2: Debería incluir gramática de nivel A2');\n      score *= 0.8;\n    }\n\n    return { errors, warnings, score };\n  }\n\n  /**\n   * VALIDAR LÓGICA SOCIAL\n   */\n  private validateSocialLogic(exercise: any): { isValid: boolean, errors: string[] } {\n    const errors: string[] = [];\n    \n    const situation = (exercise.situation || exercise.question).toLowerCase();\n    const correctOption = exercise.options[\n      typeof exercise.correct_answer === 'number' ? \n      exercise.correct_answer : \n      exercise.options.indexOf(exercise.correct_answer)\n    ]?.toLowerCase() || '';\n\n    // Reglas de lógica social\n    const socialRules = [\n      {\n        condition: situation.includes('dice hello') || situation.includes('saluda'),\n        expectedResponses: ['hello', 'hi', 'good morning'],\n        name: 'Responder saludo'\n      },\n      {\n        condition: situation.includes('te da') || situation.includes('gives you'),\n        expectedResponses: ['thank you', 'thanks', 'gracias'],\n        name: 'Agradecer cuando reciben algo'\n      },\n      {\n        condition: situation.includes('dice thank you') || situation.includes('te agradece'),\n        expectedResponses: ['you\\'re welcome', 'no problem', 'de nada'],\n        name: 'Responder a agradecimiento'\n      }\n    ];\n\n    for (const rule of socialRules) {\n      if (rule.condition) {\n        const isLogical = rule.expectedResponses.some(expected => \n          correctOption.includes(expected.toLowerCase())\n        );\n        \n        if (!isLogical) {\n          errors.push(`Lógica social incorrecta: ${rule.name}`);\n        }\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors\n    };\n  }\n\n  /**\n   * UTILIDADES DE VALIDACIÓN\n   */\n  private detectLanguage(text: string): 'spanish' | 'english' | 'unknown' {\n    const spanishWords = ['qué', 'cómo', 'dónde', 'cuándo', 'por', 'para', 'con', 'sin', 'te', 'le', 'se', 'es', 'está'];\n    const englishWords = ['what', 'how', 'where', 'when', 'the', 'and', 'you', 'are', 'is', 'can', 'do', 'have'];\n    \n    const lowerText = text.toLowerCase();\n    const spanishCount = spanishWords.filter(word => lowerText.includes(word)).length;\n    const englishCount = englishWords.filter(word => lowerText.includes(word)).length;\n    \n    if (spanishCount > englishCount) return 'spanish';\n    if (englishCount > spanishCount) return 'english';\n    return 'unknown';\n  }\n\n  private isSurvivalSituation(text: string): boolean {\n    const survivalKeywords = [\n      'saluda', 'hello', 'hola', 'dice',\n      'da', 'gives', 'comida', 'food',\n      'thank you', 'gracias', 'agradece',\n      'nombre', 'name', 'llamas',\n      'hambre', 'hungry', 'sed', 'thirsty',\n      'baño', 'bathroom', 'perdido', 'lost',\n      'ayuda', 'help', 'excuse me'\n    ];\n    \n    const lowerText = text.toLowerCase();\n    return survivalKeywords.some(keyword => lowerText.includes(keyword));\n  }\n\n  private hasAdvancedVocabulary(text: string): boolean {\n    const advancedWords = [\n      'sophisticated', 'comprehensive', 'substantial', 'significant',\n      'consequently', 'nevertheless', 'furthermore', 'moreover',\n      'perspective', 'analyze', 'evaluate', 'implement'\n    ];\n    \n    const lowerText = text.toLowerCase();\n    return advancedWords.some(word => lowerText.includes(word));\n  }\n\n  private hasA2Grammar(text: string): boolean {\n    const a2Patterns = [\n      'went', 'did', 'was', 'were', // Past simple\n      'going to', 'will', // Future\n      'have been', 'has been', // Present perfect\n      'would like', 'prefer' // Preferences\n    ];\n    \n    const lowerText = text.toLowerCase();\n    return a2Patterns.some(pattern => lowerText.includes(pattern));\n  }\n\n  private validateOptionDiversity(options: string[]): { isValid: boolean, warnings: string[] } {\n    const warnings: string[] = [];\n    \n    // Verificar longitud similar\n    const lengths = options.map(opt => opt.length);\n    const avgLength = lengths.reduce((sum, len) => sum + len, 0) / lengths.length;\n    const hasVariedLengths = lengths.some(len => Math.abs(len - avgLength) > avgLength * 0.5);\n    \n    if (!hasVariedLengths) {\n      warnings.push('Opciones tienen longitud muy similar');\n    }\n\n    // Verificar diversidad semántica\n    const uniqueWords = new Set();\n    options.forEach(option => {\n      option.toLowerCase().split(' ').forEach(word => uniqueWords.add(word));\n    });\n    \n    if (uniqueWords.size < options.length * 2) {\n      warnings.push('Opciones semánticamente muy similares');\n    }\n\n    return {\n      isValid: warnings.length === 0,\n      warnings\n    };\n  }\n\n  /**\n   * MEZCLAR OPCIONES MANTENIENDO RESPUESTA CORRECTA\n   */\n  private shuffleOptions(exercise: Exercise): Exercise {\n    const correctAnswerText = exercise.options[exercise.correct_answer];\n    \n    // Fisher-Yates shuffle\n    const shuffledOptions = [...exercise.options];\n    for (let i = shuffledOptions.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];\n    }\n    \n    // Encontrar nueva posición de la respuesta correcta\n    const newCorrectAnswer = shuffledOptions.findIndex(option => option === correctAnswerText);\n    \n    return {\n      ...exercise,\n      options: shuffledOptions,\n      correct_answer: newCorrectAnswer\n    };\n  }\n\n  /**\n   * CALCULAR DIFICULTAD DEL EJERCICIO\n   */\n  private calculateDifficulty(exercise: any, level: Level): number {\n    let difficulty = 0.5; // Base\n\n    // Ajustar por nivel\n    const levelDifficulties = { A1: 0.2, A2: 0.4, B1: 0.6, B2: 0.8 };\n    difficulty = levelDifficulties[level];\n\n    // Ajustar por longitud de pregunta\n    const questionLength = exercise.question.length;\n    if (questionLength > 100) difficulty += 0.1;\n    if (questionLength > 150) difficulty += 0.1;\n\n    // Ajustar por vocabulario\n    const hasAdvancedVocab = this.hasAdvancedVocabulary(exercise.options.join(' '));\n    if (hasAdvancedVocab) difficulty += 0.2;\n\n    return Math.min(1, Math.max(0, difficulty));\n  }\n\n  /**\n   * EJERCICIOS DE EMERGENCIA POR NIVEL\n   */\n  private generateEmergencyExercises(level: Level): Exercise[] {\n    const emergencyExercises = {\n      A1: [\n        {\n          id: 'emergency_a1_001',\n          type: 'multiple_choice' as const,\n          situation: 'Te encuentras con un compañero y te dice Hello',\n          question: '¿Qué debes responder para ser educado?',\n          options: ['Hello', 'You\\'re welcome', 'I\\'m sorry', 'Goodbye'],\n          correct_answer: 0,\n          explanation: 'Cuando alguien te saluda con \"Hello\", debes saludar de vuelta. Es cortesía básica.',\n          level: 'A1' as Level,\n          skill_focus: 'social_greetings',\n          difficulty: 0.2\n        },\n        {\n          id: 'emergency_a1_002',\n          type: 'multiple_choice' as const,\n          situation: 'Te dan comida en un restaurante',\n          question: '¿Qué dices para agradecer?',\n          options: ['Thank you', 'Hello', 'Goodbye', 'You\\'re welcome'],\n          correct_answer: 0,\n          explanation: 'Cuando alguien te da algo, debes agradecer diciendo \"Thank you\".',\n          level: 'A1' as Level,\n          skill_focus: 'courtesy',\n          difficulty: 0.2\n        }\n      ],\n      A2: [\n        {\n          id: 'emergency_a2_001',\n          type: 'multiple_choice' as const,\n          situation: 'Tu amigo pregunta sobre tu fin de semana',\n          question: '¿Cómo dices que fuiste al cine ayer?',\n          options: ['I went to the movies yesterday', 'I go to movies', 'I will go to movies', 'I am going to movies'],\n          correct_answer: 0,\n          explanation: 'Para hablar del pasado usamos \"went\" (pasado de \"go\").',\n          level: 'A2' as Level,\n          skill_focus: 'past_experiences',\n          difficulty: 0.4\n        }\n      ],\n      B1: [\n        {\n          id: 'emergency_b1_001',\n          type: 'multiple_choice' as const,\n          situation: 'In a job interview context',\n          question: 'How would you express your motivation for the position?',\n          options: ['I believe I can contribute to the team', 'I need money', 'I like jobs', 'This is a company'],\n          correct_answer: 0,\n          explanation: 'Professional responses should focus on contribution and value.',\n          level: 'B1' as Level,\n          skill_focus: 'work_situations',\n          difficulty: 0.6\n        }\n      ],\n      B2: [\n        {\n          id: 'emergency_b2_001',\n          type: 'multiple_choice' as const,\n          situation: 'Business meeting discussion',\n          question: 'How do you diplomatically present a counterargument?',\n          options: ['While I understand your perspective, I\\'d like to propose...', 'You are wrong', 'That\\'s not good', 'I disagree'],\n          correct_answer: 0,\n          explanation: 'Professional communication requires diplomatic language and respect.',\n          level: 'B2' as Level,\n          skill_focus: 'professional_communication',\n          difficulty: 0.8\n        }\n      ]\n    };\n\n    console.log(`🚨 Usando ejercicios de emergencia para nivel ${level}`);\n    return emergencyExercises[level] || emergencyExercises.A1;\n  }\n}","/**\n * CONFIGURACIÓN DE API KEY - ONBOARDING COMPLETO\n * English Master App - Setup Inicial del Usuario\n */\n\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { \n  Key, \n  ExternalLink, \n  CheckCircle, \n  AlertCircle, \n  Eye, \n  EyeOff,\n  Lightbulb,\n  Zap,\n  Shield\n} from 'lucide-react';\n\nimport { GeminiService } from '../../services/ai/GeminiService';\n\ninterface APIKeySetupProps {\n  onComplete: (apiKey: string) => void;\n}\n\nexport const APIKeySetup: React.FC<APIKeySetupProps> = ({ onComplete }) => {\n  const [apiKey, setApiKey] = useState('');\n  const [isValidating, setIsValidating] = useState(false);\n  const [error, setError] = useState('');\n  const [showKey, setShowKey] = useState(false);\n  const [currentStep, setCurrentStep] = useState<'intro' | 'setup' | 'validate'>('intro');\n\n  const validateAPIKey = async (key: string): Promise<boolean> => {\n    try {\n      const geminiService = new GeminiService(key);\n      \n      // Test básico de conectividad\n      const testExercises = await geminiService.generateExercises({\n        userId: 'test_user',\n        level: 'A1',\n        weakAreas: [],\n        completedExercises: 0,\n        sessionNumber: 1\n      });\n\n      return testExercises && testExercises.length > 0;\n    } catch (error) {\n      console.error('API Key validation error:', error);\n      return false;\n    }\n  };\n\n  const handleValidateKey = async () => {\n    if (!apiKey.trim()) {\n      setError('Por favor ingresa tu API Key');\n      return;\n    }\n\n    if (!apiKey.startsWith('AIza')) {\n      setError('La API Key debe comenzar con \"AIza\"');\n      return;\n    }\n\n    setIsValidating(true);\n    setError('');\n    \n    try {\n      const isValid = await validateAPIKey(apiKey.trim());\n      \n      if (isValid) {\n        localStorage.setItem('gemini_api_key', apiKey.trim());\n        onComplete(apiKey.trim());\n      } else {\n        setError('API Key inválida o sin permisos. Verifica que esté activa y tenga acceso a Gemini.');\n      }\n    } catch (error) {\n      setError('Error validando API Key. Verifica tu conexión a internet.');\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  const containerVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.6,\n        staggerChildren: 0.1\n      }\n    }\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: { opacity: 1, y: 0 }\n  };\n\n  // Pantalla de introducción\n  if (currentStep === 'intro') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n        <motion.div\n          variants={containerVariants}\n          initial=\"hidden\"\n          animate=\"visible\"\n          className=\"max-w-2xl mx-auto text-center space-y-8\"\n        >\n          <motion.div variants={itemVariants}>\n            <div className=\"w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <span className=\"text-white font-bold text-2xl\">EM</span>\n            </div>\n            <h1 className=\"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4\">\n              ¡Bienvenido a English Master!\n            </h1>\n            <p className=\"text-xl text-gray-600 max-w-lg mx-auto\">\n              La primera app de inglés 100% personalizada con IA que se adapta a tu nivel real\n            </p>\n          </motion.div>\n\n          <motion.div\n            variants={itemVariants}\n            className=\"grid md:grid-cols-3 gap-6 my-12\"\n          >\n            <div className=\"bg-white p-6 rounded-xl shadow-lg\">\n              <div className=\"text-3xl mb-4\">🤖</div>\n              <h3 className=\"font-bold text-lg mb-2\">IA Personal</h3>\n              <p className=\"text-gray-600 text-sm\">\n                Ejercicios únicos generados específicamente para tu nivel y debilidades\n              </p>\n            </div>\n            \n            <div className=\"bg-white p-6 rounded-xl shadow-lg\">\n              <div className=\"text-3xl mb-4\">🇪🇸</div>\n              <h3 className=\"font-bold text-lg mb-2\">Pedagogía Real</h3>\n              <p className=\"text-gray-600 text-sm\">\n                A1: Preguntas en español → Respuestas en inglés. Lógica que funciona.\n              </p>\n            </div>\n            \n            <div className=\"bg-white p-6 rounded-xl shadow-lg\">\n              <div className=\"text-3xl mb-4\">🚀</div>\n              <h3 className=\"font-bold text-lg mb-2\">Progreso Real</h3>\n              <p className=\"text-gray-600 text-sm\">\n                A1 → A2 → B1 → B2 con requisitos específicos y progresión lógica\n              </p>\n            </div>\n          </motion.div>\n\n          <motion.div variants={itemVariants}>\n            <button\n              onClick={() => setCurrentStep('setup')}\n              className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105\"\n            >\n              Comenzar Configuración\n            </button>\n          </motion.div>\n        </motion.div>\n      </div>\n    );\n  }\n\n  // Pantalla de configuración\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4\">\n      <motion.div\n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"max-w-2xl mx-auto\"\n      >\n        <div className=\"bg-white rounded-2xl shadow-2xl p-8 border border-gray-200/50\">\n          \n          {/* Header */}\n          <motion.div variants={itemVariants} className=\"text-center mb-8\">\n            <div className=\"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Key className=\"w-8 h-8 text-white\" />\n            </div>\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-2\">\n              Configura tu API Key Personal\n            </h2>\n            <p className=\"text-gray-600\">\n              Necesitas tu propia API Key de Google AI Studio para generar ejercicios únicos\n            </p>\n          </motion.div>\n\n          {/* Benefits */}\n          <motion.div variants={itemVariants} className=\"mb-8\">\n            <div className=\"bg-blue-50 rounded-xl p-6 border border-blue-200\">\n              <h3 className=\"font-bold text-blue-900 mb-4 flex items-center\">\n                <Shield className=\"w-5 h-5 mr-2\" />\n                ¿Por qué necesitas tu propia API Key?\n              </h3>\n              <div className=\"space-y-3 text-sm text-blue-800\">\n                <div className=\"flex items-start space-x-2\">\n                  <Zap className=\"w-4 h-4 mt-0.5 text-blue-600\" />\n                  <span><strong>Control total:</strong> Tus datos y progreso son 100% privados</span>\n                </div>\n                <div className=\"flex items-start space-x-2\">\n                  <Zap className=\"w-4 h-4 mt-0.5 text-blue-600\" />\n                  <span><strong>Ejercicios ilimitados:</strong> Genera tantos como necesites</span>\n                </div>\n                <div className=\"flex items-start space-x-2\">\n                  <Zap className=\"w-4 h-4 mt-0.5 text-blue-600\" />\n                  <span><strong>Personalización máxima:</strong> IA adaptada a tu progreso específico</span>\n                </div>\n              </div>\n            </div>\n          </motion.div>\n\n          {/* Instructions */}\n          <motion.div variants={itemVariants} className=\"mb-8\">\n            <h3 className=\"font-bold text-gray-900 mb-4 flex items-center\">\n              <Lightbulb className=\"w-5 h-5 mr-2 text-yellow-500\" />\n              Cómo obtener tu API Key (2 minutos):\n            </h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg\">\n                <div className=\"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold\">1</div>\n                <div className=\"flex-1\">\n                  <p className=\"text-gray-800\">\n                    Ve a{' '}\n                    <a\n                      href=\"https://aistudio.google.com/app/apikey\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-600 hover:text-blue-800 font-medium inline-flex items-center\"\n                    >\n                      Google AI Studio\n                      <ExternalLink className=\"w-4 h-4 ml-1\" />\n                    </a>\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg\">\n                <div className=\"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold\">2</div>\n                <p className=\"text-gray-800 flex-1\">Haz clic en \"Create API Key\" y selecciona tu proyecto</p>\n              </div>\n              \n              <div className=\"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg\">\n                <div className=\"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold\">3</div>\n                <p className=\"text-gray-800 flex-1\">Copia la API Key y pégala abajo</p>\n              </div>\n            </div>\n          </motion.div>\n\n          {/* API Key Input */}\n          <motion.div variants={itemVariants} className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Google AI Studio API Key\n            </label>\n            <div className=\"relative\">\n              <input\n                type={showKey ? 'text' : 'password'}\n                value={apiKey}\n                onChange={(e) => {\n                  setApiKey(e.target.value);\n                  setError('');\n                }}\n                placeholder=\"AIzaSy...\"\n                className=\"w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg font-mono\"\n                disabled={isValidating}\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowKey(!showKey)}\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\n              >\n                {showKey ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </motion.div>\n\n          {/* Error Message */}\n          {error && (\n            <motion.div\n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-start space-x-3\"\n            >\n              <AlertCircle className=\"w-5 h-5 text-red-500 mt-0.5\" />\n              <p className=\"text-red-700 text-sm\">{error}</p>\n            </motion.div>\n          )}\n\n          {/* Validation Button */}\n          <motion.button\n            variants={itemVariants}\n            onClick={handleValidateKey}\n            disabled={!apiKey.trim() || isValidating}\n            className=\"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed\"\n            whileHover={!isValidating ? { scale: 1.01 } : {}}\n            whileTap={!isValidating ? { scale: 0.99 } : {}}\n          >\n            {isValidating ? (\n              <div className=\"flex items-center justify-center space-x-2\">\n                <motion.div\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                  className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full\"\n                />\n                <span>Validando API Key...</span>\n              </div>\n            ) : (\n              <div className=\"flex items-center justify-center space-x-2\">\n                <CheckCircle className=\"w-5 h-5\" />\n                <span>Validar y Continuar</span>\n              </div>\n            )}\n          </motion.button>\n\n          {/* Security Note */}\n          <motion.div variants={itemVariants} className=\"mt-6\">\n            <div className=\"bg-green-50 border border-green-200 rounded-xl p-4\">\n              <div className=\"flex items-start space-x-2\">\n                <Shield className=\"w-5 h-5 text-green-600 mt-0.5\" />\n                <div className=\"text-sm text-green-800\">\n                  <p className=\"font-medium mb-1\">🔒 Tu API Key es segura</p>\n                  <p>Se almacena localmente en tu dispositivo y solo se usa para generar tus ejercicios personalizados.</p>\n                </div>\n              </div>\n            </div>\n          </motion.div>\n        </div>\n      </motion.div>\n    </div>\n  );\n};","/**\n * DASHBOARD PRINCIPAL - UI MODERNA CON ANIMACIONES\n * English Master App - Experiencia de Usuario Optimizada\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  User, \n  Trophy, \n  Target, \n  Clock, \n  Zap, \n  TrendingUp, \n  Award,\n  Play,\n  BarChart3,\n  Settings,\n  Star\n} from 'lucide-react';\n\nimport { UserProgress, Level, ProgressCalculation } from '../../types/progress';\nimport { ProgressService } from '../../services/firebase/ProgressService';\n\ninterface DashboardProps {\n  userProgress: UserProgress;\n  onStartSession: () => void;\n  onViewProgress: () => void;\n  onSettings: () => void;\n}\n\nexport const Dashboard: React.FC<DashboardProps> = ({\n  userProgress,\n  onStartSession,\n  onViewProgress,\n  onSettings\n}) => {\n  const [progressCalc, setProgressCalc] = useState<ProgressCalculation | null>(null);\n  const [showLevelUpCelebration, setShowLevelUpCelebration] = useState(false);\n\n  const progressService = new ProgressService();\n\n  useEffect(() => {\n    const currentLevelStats = userProgress.levelProgress[userProgress.currentLevel];\n    const calc = progressService.calculateProgress(userProgress.currentLevel, currentLevelStats);\n    setProgressCalc(calc);\n  }, [userProgress]);\n\n  const containerVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.6,\n        staggerChildren: 0.1\n      }\n    }\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: { opacity: 1, y: 0 }\n  };\n\n  return (\n    <motion.div\n      variants={containerVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\"\n    >\n      {/* Header */}\n      <motion.header\n        variants={itemVariants}\n        className=\"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-40\"\n      >\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <motion.div\n                whileHover={{ scale: 1.05 }}\n                className=\"flex items-center space-x-2\"\n              >\n                <div className=\"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-sm\">EM</span>\n                </div>\n                <h1 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  English Master\n                </h1>\n              </motion.div>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <motion.div\n                whileHover={{ scale: 1.02 }}\n                className=\"text-right\"\n              >\n                <p className=\"text-sm font-medium text-gray-900\">\n                  {userProgress.email.split('@')[0]} 👋\n                </p>\n                <p className=\"text-xs text-gray-500\">\n                  Nivel {userProgress.currentLevel} • {userProgress.currentStreak} días seguidos\n                </p>\n              </motion.div>\n\n              <motion.button\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={onSettings}\n                className=\"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors\"\n              >\n                <Settings className=\"w-5 h-5 text-gray-600\" />\n              </motion.button>\n            </div>\n          </div>\n        </div>\n      </motion.header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"space-y-8\">\n          \n          {/* Level Progress Card */}\n          <motion.div\n            variants={itemVariants}\n            className={`\n              relative overflow-hidden rounded-2xl p-6 border-2 transition-all duration-500\n              ${progressCalc?.canLevelUp \n                ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-green-300 shadow-green-100' \n                : 'bg-gradient-to-r from-blue-50 to-purple-50 border-blue-300 shadow-blue-100'\n              } shadow-xl\n            `}\n          >\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <motion.h2\n                  className={`text-3xl font-bold mb-2 ${\n                    progressCalc?.canLevelUp ? 'text-green-800' : 'text-blue-800'\n                  }`}\n                >\n                  📈 Nivel {userProgress.currentLevel} → {progressCalc?.nextLevel}\n                </motion.h2>\n                <p className={`text-sm ${\n                  progressCalc?.canLevelUp ? 'text-green-700' : 'text-blue-700'\n                }`}>\n                  {progressCalc?.canLevelUp \n                    ? '🎉 ¡Listo para subir de nivel!' \n                    : progressCalc?.requirements.description\n                  }\n                </p>\n              </div>\n\n              <motion.div\n                animate={{ \n                  scale: progressCalc?.canLevelUp ? [1, 1.1, 1] : 1,\n                  rotate: progressCalc?.canLevelUp ? [0, 5, -5, 0] : 0\n                }}\n                transition={{ \n                  duration: 2, \n                  repeat: progressCalc?.canLevelUp ? Infinity : 0 \n                }}\n                className=\"text-center\"\n              >\n                <div className={`\n                  inline-flex items-center justify-center w-20 h-20 rounded-full text-3xl font-bold\n                  ${progressCalc?.canLevelUp \n                    ? 'bg-green-500 text-white shadow-lg shadow-green-200' \n                    : 'bg-white text-blue-600 shadow-lg'\n                  }\n                `}>\n                  {progressCalc?.progressPercentage || 0}%\n                </div>\n              </motion.div>\n            </div>\n\n            {/* Progress Bar */}\n            <div className=\"mb-4\">\n              <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden\">\n                <motion.div\n                  initial={{ width: 0 }}\n                  animate={{ width: `${progressCalc?.progressPercentage || 0}%` }}\n                  transition={{ duration: 1.5, ease: \"easeOut\" }}\n                  className={`h-full rounded-full ${\n                    progressCalc?.canLevelUp \n                      ? 'bg-gradient-to-r from-green-400 to-emerald-500' \n                      : 'bg-gradient-to-r from-blue-400 to-purple-500'\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Requirements */}\n            {progressCalc && !progressCalc.canLevelUp && (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs\">\n                {progressCalc.blockedBy.map((requirement, index) => (\n                  <motion.div\n                    key={index}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: index * 0.1 }}\n                    className=\"bg-white/50 rounded-lg p-2 text-center\"\n                  >\n                    <span className=\"text-gray-600\">{requirement}</span>\n                  </motion.div>\n                ))}\n              </div>\n            )}\n\n            {/* Level Up Button */}\n            {progressCalc?.canLevelUp && (\n              <motion.button\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.95 }}\n                className=\"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-shadow\"\n                onClick={() => setShowLevelUpCelebration(true)}\n              >\n                🎉 ¡SUBIR DE NIVEL!\n              </motion.button>\n            )}\n          </motion.div>\n\n          {/* Stats Grid */}\n          <motion.div\n            variants={itemVariants}\n            className=\"grid grid-cols-1 md:grid-cols-4 gap-6\"\n          >\n            <StatsCard\n              title=\"XP Total\"\n              value={userProgress.totalXP.toLocaleString()}\n              icon={<Star className=\"w-6 h-6\" />}\n              color=\"yellow\"\n              subtitle=\"+50 hoy\"\n            />\n            <StatsCard\n              title=\"Precisión\"\n              value={`${Math.round(userProgress.overallAccuracy * 100)}%`}\n              icon={<Target className=\"w-6 h-6\" />}\n              color=\"blue\"\n              subtitle=\"Meta: 85%\"\n            />\n            <StatsCard\n              title=\"Racha\"\n              value={`${userProgress.currentStreak} días`}\n              icon={<Zap className=\"w-6 h-6\" />}\n              color=\"orange\"\n              subtitle={`Récord: ${userProgress.longestStreak}`}\n            />\n            <StatsCard\n              title=\"Tiempo Total\"\n              value={`${Math.round(userProgress.totalTimeSpent / 60)}h`}\n              icon={<Clock className=\"w-6 h-6\" />}\n              color=\"green\"\n              subtitle=\"Esta semana\"\n            />\n          </motion.div>\n\n          {/* Level Map */}\n          <motion.div\n            variants={itemVariants}\n            className=\"bg-white rounded-2xl p-6 shadow-xl border border-gray-200/50\"\n          >\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Tu Camino de Aprendizaje</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              {(['A1', 'A2', 'B1', 'B2'] as Level[]).map((level, index) => {\n                const stats = userProgress.levelProgress[level];\n                const isCurrent = userProgress.currentLevel === level;\n                const isCompleted = stats.isCompleted;\n                const isUnlocked = stats.isUnlocked;\n                \n                return (\n                  <LevelCard\n                    key={level}\n                    level={level}\n                    stats={stats}\n                    isCurrent={isCurrent}\n                    isCompleted={isCompleted}\n                    isUnlocked={isUnlocked}\n                    index={index}\n                  />\n                );\n              })}\n            </div>\n          </motion.div>\n\n          {/* Action Buttons */}\n          <motion.div\n            variants={itemVariants}\n            className=\"grid grid-cols-1 md:grid-cols-2 gap-6\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={onStartSession}\n              className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300\"\n            >\n              <div className=\"flex items-center justify-center space-x-3\">\n                <Play className=\"w-8 h-8\" />\n                <div className=\"text-left\">\n                  <h3 className=\"text-xl font-bold\">Comenzar Sesión</h3>\n                  <p className=\"text-blue-100\">8 ejercicios personalizados</p>\n                </div>\n              </div>\n            </motion.button>\n\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={onViewProgress}\n              className=\"bg-white border-2 border-gray-200 text-gray-900 p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300\"\n            >\n              <div className=\"flex items-center justify-center space-x-3\">\n                <BarChart3 className=\"w-8 h-8 text-blue-600\" />\n                <div className=\"text-left\">\n                  <h3 className=\"text-xl font-bold\">Ver Progreso</h3>\n                  <p className=\"text-gray-600\">Análisis detallado</p>\n                </div>\n              </div>\n            </motion.button>\n          </motion.div>\n        </div>\n      </main>\n\n      {/* Level Up Celebration */}\n      <AnimatePresence>\n        {showLevelUpCelebration && (\n          <LevelUpCelebration\n            newLevel={progressCalc?.nextLevel || 'A2'}\n            onClose={() => setShowLevelUpCelebration(false)}\n          />\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n};\n\n// Componente StatsCard\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  icon: React.ReactNode;\n  color: 'yellow' | 'blue' | 'orange' | 'green';\n  subtitle: string;\n}\n\nconst StatsCard: React.FC<StatsCardProps> = ({ title, value, icon, color, subtitle }) => {\n  const colorClasses = {\n    yellow: 'from-yellow-400 to-orange-500 text-yellow-600',\n    blue: 'from-blue-400 to-blue-600 text-blue-600',\n    orange: 'from-orange-400 to-red-500 text-orange-600',\n    green: 'from-green-400 to-emerald-500 text-green-600'\n  };\n\n  return (\n    <motion.div\n      whileHover={{ y: -4 }}\n      className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-200/50 hover:shadow-xl transition-all duration-300\"\n    >\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className={`p-3 rounded-lg bg-gradient-to-r ${colorClasses[color]}`}>\n          <div className=\"text-white\">\n            {icon}\n          </div>\n        </div>\n      </div>\n      <h3 className=\"text-2xl font-bold text-gray-900 mb-1\">{value}</h3>\n      <p className=\"text-sm text-gray-600 mb-1\">{title}</p>\n      <p className=\"text-xs text-gray-500\">{subtitle}</p>\n    </motion.div>\n  );\n};\n\n// Componente LevelCard\ninterface LevelCardProps {\n  level: Level;\n  stats: any;\n  isCurrent: boolean;\n  isCompleted: boolean;\n  isUnlocked: boolean;\n  index: number;\n}\n\nconst LevelCard: React.FC<LevelCardProps> = ({\n  level,\n  stats,\n  isCurrent,\n  isCompleted,\n  isUnlocked,\n  index\n}) => {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: index * 0.1 }}\n      className={`\n        p-4 rounded-xl border-2 text-center transition-all duration-300 cursor-pointer\n        ${isCurrent \n          ? 'border-blue-500 bg-blue-50 shadow-lg shadow-blue-100' : \n          isCompleted \n            ? 'border-green-500 bg-green-50 shadow-lg shadow-green-100' :\n            isUnlocked \n              ? 'border-gray-300 bg-gray-50 hover:border-gray-400' :\n              'border-gray-200 bg-gray-100 opacity-50 cursor-not-allowed'\n        }\n      `}\n      whileHover={isUnlocked ? { scale: 1.02 } : {}}\n    >\n      <div className=\"text-3xl mb-2\">\n        {isCompleted ? '🏆' : isCurrent ? '🎯' : isUnlocked ? '🔓' : '🔒'}\n      </div>\n      <div className=\"font-bold text-lg mb-1\">{level}</div>\n      <div className=\"text-sm text-gray-600 mb-2\">\n        {stats.exercisesCompleted} ejercicios\n      </div>\n      {isCompleted && stats.completedAt && (\n        <div className=\"text-xs text-green-600\">\n          Completado {new Date(stats.completedAt).toLocaleDateString()}\n        </div>\n      )}\n      {isCurrent && (\n        <div className=\"text-xs text-blue-600 font-medium\">\n          {Math.round(stats.accuracy * 100)}% precisión\n        </div>\n      )}\n    </motion.div>\n  );\n};\n\n// Componente LevelUpCelebration\ninterface LevelUpCelebrationProps {\n  newLevel: Level;\n  onClose: () => void;\n}\n\nconst LevelUpCelebration: React.FC<LevelUpCelebrationProps> = ({ newLevel, onClose }) => {\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={onClose}\n    >\n      <motion.div\n        initial={{ scale: 0, rotate: -180 }}\n        animate={{ scale: 1, rotate: 0 }}\n        exit={{ scale: 0, rotate: 180 }}\n        transition={{ type: \"spring\", duration: 0.8 }}\n        className=\"bg-white p-8 rounded-2xl text-center shadow-2xl max-w-md mx-4\"\n        onClick={e => e.stopPropagation()}\n      >\n        <motion.div\n          animate={{ \n            scale: [1, 1.2, 1],\n            rotate: [0, 10, -10, 0]\n          }}\n          transition={{ \n            duration: 2, \n            repeat: Infinity \n          }}\n          className=\"text-6xl mb-4\"\n        >\n          🎉\n        </motion.div>\n        \n        <h2 className=\"text-3xl font-bold text-yellow-500 mb-2\">\n          ¡LEVEL UP!\n        </h2>\n        \n        <p className=\"text-xl text-gray-800 mb-4\">\n          ¡Ahora eres nivel <span className=\"font-bold text-blue-600\">{newLevel}</span>!\n        </p>\n        \n        <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-xl mb-6\">\n          <p className=\"text-sm text-gray-600\">\n            Has desbloqueado nuevos ejercicios y desafíos más avanzados\n          </p>\n        </div>\n        \n        <motion.button\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={onClose}\n          className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg\"\n        >\n          ¡Continuar Aprendiendo!\n        </motion.button>\n      </motion.div>\n    </motion.div>\n  );\n};","/**\n * SESIÓN DE APRENDIZAJE - EXPERIENCIA COMPLETA\n * English Master App - Ejercicios Interactivos con IA\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  ArrowLeft, \n  ArrowRight, \n  CheckCircle, \n  XCircle, \n  Clock, \n  Target, \n  Lightbulb,\n  Volume2,\n  RotateCcw\n} from 'lucide-react';\n\nimport { GeminiService, Exercise } from '../../services/ai/GeminiService';\nimport { UserProgress, Level, SessionResults } from '../../types/progress';\n\ninterface LearningSessionProps {\n  userProgress: UserProgress;\n  apiKey: string;\n  onComplete: (results: SessionResults) => void;\n  onExit: () => void;\n}\n\nexport const LearningSession: React.FC<LearningSessionProps> = ({\n  userProgress,\n  apiKey,\n  onComplete,\n  onExit\n}) => {\n  // Estados principales\n  const [exercises, setExercises] = useState<Exercise[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);\n  const [showFeedback, setShowFeedback] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [sessionStartTime] = useState(new Date());\n  \n  // Estados de progreso\n  const [correctAnswers, setCorrectAnswers] = useState(0);\n  const [timeSpent, setTimeSpent] = useState(0);\n  const [skillsFocused, setSkillsFocused] = useState<string[]>([]);\n  const [weakAreas, setWeakAreas] = useState<string[]>([]);\n\n  const geminiService = new GeminiService(apiKey);\n  const currentExercise = exercises[currentIndex];\n  const isLastExercise = currentIndex === exercises.length - 1;\n\n  // Timer para rastrear tiempo\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setTimeSpent(Math.floor((Date.now() - sessionStartTime.getTime()) / 1000 / 60));\n    }, 60000);\n\n    return () => clearInterval(timer);\n  }, [sessionStartTime]);\n\n  // Generar ejercicios al iniciar\n  useEffect(() => {\n    generateSession();\n  }, []);\n\n  const generateSession = async () => {\n    try {\n      setIsLoading(true);\n      \n      const currentLevelStats = userProgress.levelProgress[userProgress.currentLevel];\n      \n      const generatedExercises = await geminiService.generateExercises({\n        userId: userProgress.userId,\n        level: userProgress.currentLevel,\n        weakAreas: currentLevelStats.weakAreas,\n        completedExercises: currentLevelStats.exercisesCompleted,\n        sessionNumber: currentLevelStats.sessionsCompleted + 1\n      });\n\n      setExercises(generatedExercises);\n      setIsLoading(false);\n      \n      console.log(`🎯 Sesión generada: ${generatedExercises.length} ejercicios nivel ${userProgress.currentLevel}`);\n      \n    } catch (error) {\n      console.error('❌ Error generando sesión:', error);\n      setIsLoading(false);\n      // TODO: Mostrar error al usuario\n    }\n  };\n\n  const handleAnswerSelect = (answerIndex: number) => {\n    if (showFeedback) return;\n    \n    setSelectedAnswer(answerIndex);\n    setShowFeedback(true);\n    \n    const isCorrect = answerIndex === currentExercise.correct_answer;\n    \n    if (isCorrect) {\n      setCorrectAnswers(prev => prev + 1);\n    } else {\n      // Agregar área débil\n      setWeakAreas(prev => [...prev, currentExercise.skill_focus]);\n    }\n    \n    // Agregar skill enfocado\n    setSkillsFocused(prev => Array.from(new Set([...prev, currentExercise.skill_focus])));\n  };\n\n  const handleContinue = () => {\n    if (isLastExercise) {\n      completeSession();\n    } else {\n      setCurrentIndex(prev => prev + 1);\n      setSelectedAnswer(null);\n      setShowFeedback(false);\n    }\n  };\n\n  const completeSession = () => {\n    const sessionResults: SessionResults = {\n      userId: userProgress.userId,\n      sessionId: `session_${Date.now()}`,\n      level: userProgress.currentLevel,\n      exercisesCompleted: exercises.length,\n      correctAnswers,\n      totalAnswers: exercises.length,\n      accuracy: correctAnswers / exercises.length,\n      xpEarned: correctAnswers * 10 + (exercises.length * 5), // 10 XP por correcto + 5 bonus por ejercicio\n      timeSpent,\n      skillsFocused: Array.from(new Set(skillsFocused)),\n      weakAreasIdentified: Array.from(new Set(weakAreas)),\n      startTime: sessionStartTime,\n      endTime: new Date()\n    };\n\n    onComplete(sessionResults);\n  };\n\n  const speakText = (text: string) => {\n    if ('speechSynthesis' in window) {\n      const utterance = new SpeechSynthesisUtterance(text);\n      utterance.lang = 'en-US';\n      utterance.rate = 0.8;\n      speechSynthesis.speak(utterance);\n    }\n  };\n\n  // Loading State\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center\"\n        >\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n            className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4\"\n          />\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">\n            Generando tu sesión personalizada...\n          </h2>\n          <p className=\"text-gray-600\">\n            Creando ejercicios específicos para tu nivel {userProgress.currentLevel}\n          </p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  // Error State\n  if (!exercises.length) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-center max-w-md mx-4\"\n        >\n          <div className=\"text-6xl mb-4\">😕</div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">\n            No se pudieron generar ejercicios\n          </h2>\n          <p className=\"text-gray-600 mb-6\">\n            Verifica tu conexión y API key, luego intenta de nuevo.\n          </p>\n          <div className=\"space-y-3\">\n            <button\n              onClick={generateSession}\n              className=\"w-full bg-blue-500 text-white py-3 rounded-xl font-medium hover:bg-blue-600 transition-colors\"\n            >\n              <RotateCcw className=\"w-5 h-5 inline mr-2\" />\n              Intentar de nuevo\n            </button>\n            <button\n              onClick={onExit}\n              className=\"w-full bg-gray-200 text-gray-800 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors\"\n            >\n              Volver al Dashboard\n            </button>\n          </div>\n        </motion.div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\n      {/* Header */}\n      <header className=\"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-40\">\n        <div className=\"max-w-4xl mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <button\n              onClick={onExit}\n              className=\"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n              <span>Salir</span>\n            </button>\n\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                <Target className=\"w-4 h-4\" />\n                <span>{correctAnswers}/{exercises.length}</span>\n              </div>\n              <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                <Clock className=\"w-4 h-4\" />\n                <span>{timeSpent} min</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Progress Bar */}\n          <div className=\"mt-4\">\n            <div className=\"flex justify-between text-sm text-gray-600 mb-2\">\n              <span>Progreso</span>\n              <span>{currentIndex + 1} de {exercises.length}</span>\n            </div>\n            <div className=\"w-full bg-gray-200 rounded-full h-2\">\n              <motion.div\n                initial={{ width: 0 }}\n                animate={{ width: `${((currentIndex + 1) / exercises.length) * 100}%` }}\n                transition={{ duration: 0.3 }}\n                className=\"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full\"\n              />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-4xl mx-auto px-4 py-8\">\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={currentIndex}\n            initial={{ opacity: 0, x: 50 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -50 }}\n            transition={{ duration: 0.3 }}\n            className=\"space-y-6\"\n          >\n            {/* Exercise Card */}\n            <div className=\"bg-white rounded-2xl p-8 shadow-xl border border-gray-200/50\">\n              \n              {/* Situation Context */}\n              {currentExercise.situation && (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"bg-blue-50 rounded-xl p-4 mb-6\"\n                >\n                  <h3 className=\"text-sm font-medium text-blue-800 mb-2\">Situación:</h3>\n                  <p className=\"text-blue-700\">{currentExercise.situation}</p>\n                </motion.div>\n              )}\n\n              {/* Question */}\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className=\"mb-8\"\n              >\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h2 className=\"text-2xl font-bold text-gray-900\">\n                    {currentExercise.question}\n                  </h2>\n                  <button\n                    onClick={() => speakText(currentExercise.question)}\n                    className=\"p-2 text-gray-400 hover:text-blue-500 transition-colors\"\n                  >\n                    <Volume2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <p className=\"text-gray-600\">Selecciona la respuesta correcta:</p>\n              </motion.div>\n\n              {/* Options */}\n              <div className=\"space-y-3 mb-8\">\n                {currentExercise.options.map((option, index) => {\n                  const isSelected = selectedAnswer === index;\n                  const isCorrect = index === currentExercise.correct_answer;\n                  const showResult = showFeedback;\n\n                  let optionClass = \"w-full p-4 text-left rounded-xl border-2 transition-all duration-300 \";\n                  \n                  if (!showResult) {\n                    optionClass += isSelected \n                      ? \"border-blue-500 bg-blue-50 text-blue-800\" \n                      : \"border-gray-200 bg-gray-50 hover:border-gray-300 hover:bg-gray-100\";\n                  } else {\n                    if (isCorrect) {\n                      optionClass += \"border-green-500 bg-green-50 text-green-800\";\n                    } else if (isSelected && !isCorrect) {\n                      optionClass += \"border-red-500 bg-red-50 text-red-800\";\n                    } else {\n                      optionClass += \"border-gray-200 bg-gray-100 text-gray-600\";\n                    }\n                  }\n\n                  return (\n                    <motion.button\n                      key={index}\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: 0.2 + index * 0.1 }}\n                      onClick={() => handleAnswerSelect(index)}\n                      disabled={showFeedback}\n                      className={optionClass}\n                      whileHover={!showFeedback ? { scale: 1.01 } : {}}\n                      whileTap={!showFeedback ? { scale: 0.99 } : {}}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-3\">\n                          <span className=\"text-lg font-bold\">\n                            {String.fromCharCode(65 + index)})\n                          </span>\n                          <span className=\"text-lg\">{option}</span>\n                        </div>\n                        \n                        {showResult && (\n                          <div>\n                            {isCorrect && (\n                              <CheckCircle className=\"w-6 h-6 text-green-500\" />\n                            )}\n                            {isSelected && !isCorrect && (\n                              <XCircle className=\"w-6 h-6 text-red-500\" />\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </motion.button>\n                  );\n                })}\n              </div>\n\n              {/* Feedback */}\n              <AnimatePresence>\n                {showFeedback && (\n                  <motion.div\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    className={`rounded-xl p-6 mb-6 ${\n                      selectedAnswer === currentExercise.correct_answer\n                        ? 'bg-green-50 border border-green-200'\n                        : 'bg-red-50 border border-red-200'\n                    }`}\n                  >\n                    <div className=\"flex items-start space-x-3\">\n                      <div className=\"mt-1\">\n                        {selectedAnswer === currentExercise.correct_answer ? (\n                          <CheckCircle className=\"w-6 h-6 text-green-500\" />\n                        ) : (\n                          <XCircle className=\"w-6 h-6 text-red-500\" />\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className={`font-bold mb-2 ${\n                          selectedAnswer === currentExercise.correct_answer\n                            ? 'text-green-800'\n                            : 'text-red-800'\n                        }`}>\n                          {selectedAnswer === currentExercise.correct_answer\n                            ? '🎉 ¡Correcto! +10 XP'\n                            : '❌ Incorrecto, pero +3 XP por intentar'\n                          }\n                        </h3>\n                        <div className=\"flex items-start space-x-2\">\n                          <Lightbulb className=\"w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0\" />\n                          <p className=\"text-gray-700\">\n                            <strong>Explicación:</strong> {currentExercise.explanation}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Continue Button */}\n              {showFeedback && (\n                <motion.button\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  onClick={handleContinue}\n                  className=\"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300\"\n                  whileHover={{ scale: 1.01 }}\n                  whileTap={{ scale: 0.99 }}\n                >\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <span>\n                      {isLastExercise ? 'Completar Sesión' : 'Siguiente Pregunta'}\n                    </span>\n                    <ArrowRight className=\"w-5 h-5\" />\n                  </div>\n                </motion.button>\n              )}\n            </div>\n          </motion.div>\n        </AnimatePresence>\n      </main>\n    </div>\n  );\n};","/**\n * VISTA DE PROGRESO DETALLADO - ENGLISH MASTER APP\n * Analytics y métricas completas del usuario\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { \n  ArrowLeft, \n  TrendingUp, \n  Calendar, \n  Target, \n  Clock, \n  Award,\n  BarChart3,\n  Activity,\n  Zap,\n  Star\n} from 'lucide-react';\nimport { \n  LineChart, \n  Line, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  BarChart,\n  Bar,\n  PieChart,\n  Pie,\n  Cell\n} from 'recharts';\n\nimport { UserProgress } from '../../types/progress';\n\ninterface ProgressViewProps {\n  userProgress: UserProgress;\n  onBack: () => void;\n}\n\nexport const ProgressView: React.FC<ProgressViewProps> = ({\n  userProgress,\n  onBack\n}) => {\n  const [timeRange, setTimeRange] = useState<'week' | 'month' | 'all'>('week');\n  const [activeTab, setActiveTab] = useState<'overview' | 'levels' | 'skills' | 'achievements'>('overview');\n\n  // Datos simulados para gráficos (en una app real vendrían de Firebase)\n  const weeklyData = [\n    { day: 'Lun', exercises: 12, accuracy: 85, xp: 120 },\n    { day: 'Mar', exercises: 8, accuracy: 78, xp: 95 },\n    { day: 'Mié', exercises: 15, accuracy: 92, xp: 150 },\n    { day: 'Jue', exercises: 10, accuracy: 88, xp: 110 },\n    { day: 'Vie', exercises: 18, accuracy: 94, xp: 180 },\n    { day: 'Sáb', exercises: 6, accuracy: 75, xp: 70 },\n    { day: 'Dom', exercises: 9, accuracy: 82, xp: 95 }\n  ];\n\n  const levelData = [\n    { level: 'A1', progress: 100, color: '#10B981' },\n    { level: 'A2', progress: 65, color: '#3B82F6' },\n    { level: 'B1', progress: 25, color: '#8B5CF6' },\n    { level: 'B2', progress: 0, color: '#6B7280' }\n  ];\n\n  const skillsData = [\n    { skill: 'Saludos', mastery: 95, exercises: 45 },\n    { skill: 'Necesidades Básicas', mastery: 88, exercises: 32 },\n    { skill: 'Cortesía', mastery: 92, exercises: 28 },\n    { skill: 'Información Personal', mastery: 78, exercises: 24 },\n    { skill: 'Rutinas Diarias', mastery: 65, exercises: 18 }\n  ];\n\n  const containerVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.6,\n        staggerChildren: 0.1\n      }\n    }\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: { opacity: 1, y: 0 }\n  };\n\n  return (\n    <motion.div\n      variants={containerVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50\"\n    >\n      {/* Header */}\n      <motion.header\n        variants={itemVariants}\n        className=\"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-40\"\n      >\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <button\n              onClick={onBack}\n              className=\"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n              <span>Volver al Dashboard</span>\n            </button>\n\n            <h1 className=\"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n              Mi Progreso\n            </h1>\n\n            <div className=\"flex items-center space-x-2\">\n              <select\n                value={timeRange}\n                onChange={(e) => setTimeRange(e.target.value as any)}\n                className=\"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              >\n                <option value=\"week\">Esta semana</option>\n                <option value=\"month\">Este mes</option>\n                <option value=\"all\">Todo el tiempo</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Tabs */}\n          <div className=\"flex space-x-8 border-b border-gray-200\">\n            {[\n              { id: 'overview', label: 'Resumen', icon: BarChart3 },\n              { id: 'levels', label: 'Niveles', icon: TrendingUp },\n              { id: 'skills', label: 'Habilidades', icon: Target },\n              { id: 'achievements', label: 'Logros', icon: Award }\n            ].map((tab) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id as any)}\n                  className={`flex items-center space-x-2 py-4 border-b-2 transition-colors ${\n                    activeTab === tab.id\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span className=\"font-medium\">{tab.label}</span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </motion.header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {activeTab === 'overview' && (\n          <div className=\"space-y-8\">\n            {/* Stats Cards */}\n            <motion.div\n              variants={itemVariants}\n              className=\"grid grid-cols-1 md:grid-cols-4 gap-6\"\n            >\n              <StatsCard\n                title=\"Total XP\"\n                value={userProgress.totalXP.toLocaleString()}\n                icon={<Star className=\"w-6 h-6\" />}\n                color=\"yellow\"\n                change=\"+12%\"\n                period=\"esta semana\"\n              />\n              <StatsCard\n                title=\"Ejercicios\"\n                value={userProgress.totalExercises.toString()}\n                icon={<Activity className=\"w-6 h-6\" />}\n                color=\"blue\"\n                change=\"+8%\"\n                period=\"esta semana\"\n              />\n              <StatsCard\n                title=\"Precisión\"\n                value={`${Math.round(userProgress.overallAccuracy * 100)}%`}\n                icon={<Target className=\"w-6 h-6\" />}\n                color=\"green\"\n                change=\"+3%\"\n                period=\"esta semana\"\n              />\n              <StatsCard\n                title=\"Racha\"\n                value={`${userProgress.currentStreak} días`}\n                icon={<Zap className=\"w-6 h-6\" />}\n                color=\"orange\"\n                change=\"Activa\"\n                period={`récord: ${userProgress.longestStreak}`}\n              />\n            </motion.div>\n\n            {/* Charts */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              {/* Weekly Progress Chart */}\n              <motion.div\n                variants={itemVariants}\n                className=\"bg-white rounded-2xl p-6 shadow-xl border border-gray-200/50\"\n              >\n                <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Progreso Semanal</h3>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <LineChart data={weeklyData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"day\" />\n                    <YAxis />\n                    <Tooltip />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"exercises\" \n                      stroke=\"#3B82F6\" \n                      strokeWidth={3}\n                      dot={{ fill: '#3B82F6', strokeWidth: 2, r: 4 }}\n                    />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"accuracy\" \n                      stroke=\"#10B981\" \n                      strokeWidth={3}\n                      dot={{ fill: '#10B981', strokeWidth: 2, r: 4 }}\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              </motion.div>\n\n              {/* XP Distribution */}\n              <motion.div\n                variants={itemVariants}\n                className=\"bg-white rounded-2xl p-6 shadow-xl border border-gray-200/50\"\n              >\n                <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Distribución de XP</h3>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <BarChart data={weeklyData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"day\" />\n                    <YAxis />\n                    <Tooltip />\n                    <Bar \n                      dataKey=\"xp\" \n                      fill=\"url(#xpGradient)\"\n                      radius={[4, 4, 0, 0]}\n                    />\n                    <defs>\n                      <linearGradient id=\"xpGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#8B5CF6\" stopOpacity={0.8}/>\n                        <stop offset=\"95%\" stopColor=\"#8B5CF6\" stopOpacity={0.3}/>\n                      </linearGradient>\n                    </defs>\n                  </BarChart>\n                </ResponsiveContainer>\n              </motion.div>\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'levels' && (\n          <motion.div variants={itemVariants} className=\"space-y-8\">\n            <div className=\"bg-white rounded-2xl p-6 shadow-xl border border-gray-200/50\">\n              <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Progreso por Niveles</h3>\n              \n              <div className=\"space-y-6\">\n                {levelData.map((level, index) => (\n                  <div key={level.level} className=\"space-y-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div \n                          className=\"w-4 h-4 rounded-full\"\n                          style={{ backgroundColor: level.color }}\n                        />\n                        <span className=\"font-semibold text-lg\">Nivel {level.level}</span>\n                        {level.level === userProgress.currentLevel && (\n                          <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium\">\n                            Actual\n                          </span>\n                        )}\n                      </div>\n                      <span className=\"text-sm text-gray-600\">{level.progress}%</span>\n                    </div>\n                    \n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <motion.div\n                        initial={{ width: 0 }}\n                        animate={{ width: `${level.progress}%` }}\n                        transition={{ duration: 1, delay: index * 0.2 }}\n                        className=\"h-3 rounded-full\"\n                        style={{ backgroundColor: level.color }}\n                      />\n                    </div>\n                    \n                    <div className=\"grid grid-cols-3 gap-4 text-sm text-gray-600\">\n                      <div>\n                        <span className=\"font-medium\">Ejercicios:</span> {\n                          userProgress.levelProgress[level.level as keyof typeof userProgress.levelProgress]?.exercisesCompleted || 0\n                        }\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Precisión:</span> {\n                          Math.round((userProgress.levelProgress[level.level as keyof typeof userProgress.levelProgress]?.accuracy || 0) * 100)\n                        }%\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">XP:</span> {\n                          userProgress.levelProgress[level.level as keyof typeof userProgress.levelProgress]?.xpEarned || 0\n                        }\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n\n        {activeTab === 'skills' && (\n          <motion.div variants={itemVariants} className=\"space-y-8\">\n            <div className=\"bg-white rounded-2xl p-6 shadow-xl border border-gray-200/50\">\n              <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Dominio de Habilidades</h3>\n              \n              <div className=\"space-y-6\">\n                {skillsData.map((skill, index) => (\n                  <div key={skill.skill} className=\"space-y-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-semibold\">{skill.skill}</span>\n                      <div className=\"text-right text-sm text-gray-600\">\n                        <div>{skill.mastery}% dominada</div>\n                        <div>{skill.exercises} ejercicios</div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                      <motion.div\n                        initial={{ width: 0 }}\n                        animate={{ width: `${skill.mastery}%` }}\n                        transition={{ duration: 1, delay: index * 0.1 }}\n                        className={`h-3 rounded-full ${\n                          skill.mastery >= 90 ? 'bg-green-500' :\n                          skill.mastery >= 70 ? 'bg-blue-500' :\n                          skill.mastery >= 50 ? 'bg-yellow-500' : 'bg-red-500'\n                        }`}\n                      />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n\n        {activeTab === 'achievements' && (\n          <motion.div variants={itemVariants} className=\"space-y-8\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {/* Achievement Cards */}\n              <AchievementCard\n                title=\"Primer Paso\"\n                description=\"Completa tu primera sesión\"\n                icon=\"🎯\"\n                unlocked={true}\n                date=\"Hace 5 días\"\n              />\n              <AchievementCard\n                title=\"Saludador Experto\"\n                description=\"Domina los saludos básicos\"\n                icon=\"👋\"\n                unlocked={true}\n                date=\"Hace 3 días\"\n              />\n              <AchievementCard\n                title=\"Racha de Fuego\"\n                description=\"Mantén una racha de 7 días\"\n                icon=\"🔥\"\n                unlocked={userProgress.currentStreak >= 7}\n                date={userProgress.currentStreak >= 7 ? \"Hoy\" : undefined}\n              />\n              <AchievementCard\n                title=\"Maestro A1\"\n                description=\"Completa el nivel A1\"\n                icon=\"🏆\"\n                unlocked={false}\n              />\n              <AchievementCard\n                title=\"Precisión Perfecta\"\n                description=\"Logra 95% de precisión\"\n                icon=\"🎯\"\n                unlocked={userProgress.overallAccuracy >= 0.95}\n              />\n              <AchievementCard\n                title=\"Explorador B1\"\n                description=\"Desbloquea el nivel B1\"\n                icon=\"🗺️\"\n                unlocked={false}\n              />\n            </div>\n          </motion.div>\n        )}\n      </main>\n    </motion.div>\n  );\n};\n\n// Componentes auxiliares\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  icon: React.ReactNode;\n  color: 'yellow' | 'blue' | 'green' | 'orange';\n  change: string;\n  period: string;\n}\n\nconst StatsCard: React.FC<StatsCardProps> = ({ title, value, icon, color, change, period }) => {\n  const colorClasses = {\n    yellow: 'from-yellow-400 to-orange-500 text-yellow-600',\n    blue: 'from-blue-400 to-blue-600 text-blue-600',\n    green: 'from-green-400 to-emerald-500 text-green-600',\n    orange: 'from-orange-400 to-red-500 text-orange-600'\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl p-6 shadow-lg border border-gray-200/50\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className={`p-3 rounded-lg bg-gradient-to-r ${colorClasses[color]}`}>\n          <div className=\"text-white\">{icon}</div>\n        </div>\n      </div>\n      <h3 className=\"text-2xl font-bold text-gray-900 mb-1\">{value}</h3>\n      <p className=\"text-sm text-gray-600 mb-2\">{title}</p>\n      <div className=\"flex items-center space-x-1 text-xs\">\n        <span className=\"text-green-600 font-medium\">{change}</span>\n        <span className=\"text-gray-500\">{period}</span>\n      </div>\n    </div>\n  );\n};\n\ninterface AchievementCardProps {\n  title: string;\n  description: string;\n  icon: string;\n  unlocked: boolean;\n  date?: string;\n}\n\nconst AchievementCard: React.FC<AchievementCardProps> = ({ \n  title, \n  description, \n  icon, \n  unlocked, \n  date \n}) => (\n  <div className={`\n    p-6 rounded-xl border-2 transition-all duration-300\n    ${unlocked \n      ? 'bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-300 shadow-lg' \n      : 'bg-gray-50 border-gray-200 opacity-60'\n    }\n  `}>\n    <div className=\"text-center\">\n      <div className=\"text-4xl mb-3\">{unlocked ? icon : '🔒'}</div>\n      <h3 className=\"font-bold text-lg mb-2\">{title}</h3>\n      <p className=\"text-sm text-gray-600 mb-3\">{description}</p>\n      {unlocked && date && (\n        <p className=\"text-xs text-green-600 font-medium\">Desbloqueado {date}</p>\n      )}\n      {!unlocked && (\n        <p className=\"text-xs text-gray-500\">Bloqueado</p>\n      )}\n    </div>\n  </div>\n);","/**\n * VISTA DE CONFIGURACIÓN - ENGLISH MASTER APP\n * Configuración de usuario, preferencias y gestión de cuenta\n */\n\nimport React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { signOut } from 'firebase/auth';\nimport { \n  ArrowLeft, \n  User, \n  Settings, \n  Key, \n  Bell, \n  Volume2, \n  Palette, \n  Globe, \n  Shield,\n  LogOut,\n  Trash2,\n  Save,\n  Eye,\n  EyeOff,\n  Target\n} from 'lucide-react';\nimport toast from 'react-hot-toast';\n\nimport { auth } from '../../services/firebase/config';\nimport { UserProgress } from '../../types/progress';\nimport { ProgressService } from '../../services/firebase/ProgressService';\n\ninterface SettingsViewProps {\n  userProgress: UserProgress;\n  onBack: () => void;\n  onUpdateProgress: (progress: UserProgress) => void;\n}\n\nexport const SettingsView: React.FC<SettingsViewProps> = ({\n  userProgress,\n  onBack,\n  onUpdateProgress\n}) => {\n  const [activeTab, setActiveTab] = useState<'profile' | 'preferences' | 'api' | 'privacy'>('profile');\n  const [isLoading, setIsLoading] = useState(false);\n  const [showApiKey, setShowApiKey] = useState(false);\n  \n  // Estados para edición\n  const [editedPreferences, setEditedPreferences] = useState(userProgress.preferences);\n  const [newApiKey, setNewApiKey] = useState('');\n\n  const progressService = new ProgressService();\n\n  const handleSavePreferences = async () => {\n    try {\n      setIsLoading(true);\n      \n      const updatedProgress = {\n        ...userProgress,\n        preferences: editedPreferences\n      };\n      \n      // Aquí se guardaría en Firebase\n      // await progressService.updateUserPreferences(userProgress.userId, editedPreferences);\n      \n      onUpdateProgress(updatedProgress);\n      toast.success('Preferencias guardadas exitosamente');\n      \n    } catch (error) {\n      console.error('Error saving preferences:', error);\n      toast.error('Error guardando preferencias');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleUpdateApiKey = async () => {\n    if (!newApiKey.trim()) {\n      toast.error('Ingresa una API Key válida');\n      return;\n    }\n\n    try {\n      setIsLoading(true);\n      \n      // Validar nueva API Key\n      // const isValid = await validateApiKey(newApiKey);\n      // if (!isValid) {\n      //   toast.error('API Key inválida');\n      //   return;\n      // }\n      \n      localStorage.setItem('gemini_api_key', newApiKey);\n      \n      const updatedProgress = {\n        ...userProgress,\n        apiKey: btoa(newApiKey) // Encriptar\n      };\n      \n      onUpdateProgress(updatedProgress);\n      toast.success('API Key actualizada exitosamente');\n      setNewApiKey('');\n      \n    } catch (error) {\n      console.error('Error updating API key:', error);\n      toast.error('Error actualizando API Key');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSignOut = async () => {\n    try {\n      await signOut(auth);\n      toast.success('Sesión cerrada exitosamente');\n    } catch (error) {\n      console.error('Error signing out:', error);\n      toast.error('Error cerrando sesión');\n    }\n  };\n\n  const handleDeleteAccount = async () => {\n    const confirmed = window.confirm(\n      '¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.'\n    );\n    \n    if (!confirmed) return;\n\n    try {\n      setIsLoading(true);\n      \n      // Aquí se eliminaría la cuenta y todos los datos\n      // await progressService.deleteUserAccount(userProgress.userId);\n      // await auth.currentUser?.delete();\n      \n      toast.success('Cuenta eliminada exitosamente');\n      \n    } catch (error) {\n      console.error('Error deleting account:', error);\n      toast.error('Error eliminando cuenta');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const containerVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.6,\n        staggerChildren: 0.1\n      }\n    }\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: { opacity: 1, y: 0 }\n  };\n\n  return (\n    <motion.div\n      variants={containerVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50\"\n    >\n      {/* Header */}\n      <motion.header\n        variants={itemVariants}\n        className=\"bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-40\"\n      >\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <button\n              onClick={onBack}\n              className=\"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n              <span>Volver al Dashboard</span>\n            </button>\n\n            <h1 className=\"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n              Configuración\n            </h1>\n\n            <div className=\"w-32\"></div> {/* Spacer */}\n          </div>\n\n          {/* Tabs */}\n          <div className=\"flex space-x-8 border-b border-gray-200\">\n            {[\n              { id: 'profile', label: 'Perfil', icon: User },\n              { id: 'preferences', label: 'Preferencias', icon: Settings },\n              { id: 'api', label: 'API Key', icon: Key },\n              { id: 'privacy', label: 'Privacidad', icon: Shield }\n            ].map((tab) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id as any)}\n                  className={`flex items-center space-x-2 py-4 border-b-2 transition-colors ${\n                    activeTab === tab.id\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span className=\"font-medium\">{tab.label}</span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </motion.header>\n\n      {/* Main Content */}\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"bg-white rounded-2xl shadow-xl border border-gray-200/50 overflow-hidden\">\n          \n          {/* Profile Tab */}\n          {activeTab === 'profile' && (\n            <motion.div variants={itemVariants} className=\"p-8 space-y-8\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Información del Perfil</h2>\n              \n              <div className=\"flex items-center space-x-6\">\n                <div className=\"w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-2xl\">\n                    {userProgress.email.charAt(0).toUpperCase()}\n                  </span>\n                </div>\n                \n                <div>\n                  <h3 className=\"text-xl font-semibold text-gray-900\">\n                    {userProgress.email.split('@')[0]}\n                  </h3>\n                  <p className=\"text-gray-600\">{userProgress.email}</p>\n                  <p className=\"text-sm text-gray-500\">\n                    Miembro desde {new Date(userProgress.createdAt).toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <div className=\"bg-blue-50 p-6 rounded-xl border border-blue-200\">\n                  <h4 className=\"font-semibold text-blue-900 mb-2\">Nivel Actual</h4>\n                  <p className=\"text-2xl font-bold text-blue-700\">{userProgress.currentLevel}</p>\n                </div>\n                \n                <div className=\"bg-green-50 p-6 rounded-xl border border-green-200\">\n                  <h4 className=\"font-semibold text-green-900 mb-2\">Total XP</h4>\n                  <p className=\"text-2xl font-bold text-green-700\">{userProgress.totalXP.toLocaleString()}</p>\n                </div>\n                \n                <div className=\"bg-purple-50 p-6 rounded-xl border border-purple-200\">\n                  <h4 className=\"font-semibold text-purple-900 mb-2\">Racha Actual</h4>\n                  <p className=\"text-2xl font-bold text-purple-700\">{userProgress.currentStreak} días</p>\n                </div>\n              </div>\n            </motion.div>\n          )}\n\n          {/* Preferences Tab */}\n          {activeTab === 'preferences' && (\n            <motion.div variants={itemVariants} className=\"p-8 space-y-8\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Preferencias</h2>\n              \n              <div className=\"space-y-6\">\n                {/* Daily Goal */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    <Target className=\"w-4 h-4 inline mr-2\" />\n                    Meta diaria de ejercicios\n                  </label>\n                  <select\n                    value={editedPreferences.dailyGoal}\n                    onChange={(e) => setEditedPreferences({\n                      ...editedPreferences,\n                      dailyGoal: parseInt(e.target.value)\n                    })}\n                    className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  >\n                    <option value={10}>10 ejercicios</option>\n                    <option value={20}>20 ejercicios</option>\n                    <option value={30}>30 ejercicios</option>\n                    <option value={50}>50 ejercicios</option>\n                  </select>\n                </div>\n\n                {/* Reminder Time */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    <Bell className=\"w-4 h-4 inline mr-2\" />\n                    Recordatorio diario\n                  </label>\n                  <input\n                    type=\"time\"\n                    value={editedPreferences.reminderTime || '19:00'}\n                    onChange={(e) => setEditedPreferences({\n                      ...editedPreferences,\n                      reminderTime: e.target.value\n                    })}\n                    className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                {/* Sound Settings */}\n                <div>\n                  <label className=\"flex items-center space-x-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={editedPreferences.soundEnabled}\n                      onChange={(e) => setEditedPreferences({\n                        ...editedPreferences,\n                        soundEnabled: e.target.checked\n                      })}\n                      className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                    />\n                    <Volume2 className=\"w-4 h-4 text-gray-600\" />\n                    <span className=\"text-sm font-medium text-gray-700\">\n                      Habilitar sonidos y pronunciación\n                    </span>\n                  </label>\n                </div>\n\n                {/* Animations */}\n                <div>\n                  <label className=\"flex items-center space-x-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={editedPreferences.animationsEnabled}\n                      onChange={(e) => setEditedPreferences({\n                        ...editedPreferences,\n                        animationsEnabled: e.target.checked\n                      })}\n                      className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                    />\n                    <Palette className=\"w-4 h-4 text-gray-600\" />\n                    <span className=\"text-sm font-medium text-gray-700\">\n                      Habilitar animaciones\n                    </span>\n                  </label>\n                </div>\n\n                {/* Explanation Language */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    <Globe className=\"w-4 h-4 inline mr-2\" />\n                    Idioma de explicaciones\n                  </label>\n                  <select\n                    value={editedPreferences.explanationLanguage}\n                    onChange={(e) => setEditedPreferences({\n                      ...editedPreferences,\n                      explanationLanguage: e.target.value as 'es' | 'en'\n                    })}\n                    className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  >\n                    <option value=\"es\">Español</option>\n                    <option value=\"en\">English</option>\n                  </select>\n                </div>\n\n                {/* Save Button */}\n                <button\n                  onClick={handleSavePreferences}\n                  disabled={isLoading}\n                  className=\"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50\"\n                >\n                  <Save className=\"w-5 h-5 inline mr-2\" />\n                  {isLoading ? 'Guardando...' : 'Guardar Preferencias'}\n                </button>\n              </div>\n            </motion.div>\n          )}\n\n          {/* API Key Tab */}\n          {activeTab === 'api' && (\n            <motion.div variants={itemVariants} className=\"p-8 space-y-8\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Gestión de API Key</h2>\n              \n              <div className=\"space-y-6\">\n                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-6\">\n                  <h3 className=\"font-semibold text-blue-900 mb-2\">API Key Actual</h3>\n                  <div className=\"flex items-center space-x-3\">\n                    <input\n                      type={showApiKey ? 'text' : 'password'}\n                      value={showApiKey ? atob(userProgress.apiKey) : '••••••••••••••••'}\n                      readOnly\n                      className=\"flex-1 p-3 bg-white border border-blue-300 rounded-lg font-mono text-sm\"\n                    />\n                    <button\n                      onClick={() => setShowApiKey(!showApiKey)}\n                      className=\"p-3 text-blue-600 hover:text-blue-800 transition-colors\"\n                    >\n                      {showApiKey ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n                    </button>\n                  </div>\n                  <p className=\"text-sm text-blue-700 mt-2\">\n                    Tu API Key está segura y encriptada. Solo se usa para generar ejercicios personalizados.\n                  </p>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Nueva API Key (opcional)\n                  </label>\n                  <div className=\"flex space-x-3\">\n                    <input\n                      type=\"password\"\n                      value={newApiKey}\n                      onChange={(e) => setNewApiKey(e.target.value)}\n                      placeholder=\"AIzaSy...\"\n                      className=\"flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono\"\n                    />\n                    <button\n                      onClick={handleUpdateApiKey}\n                      disabled={isLoading || !newApiKey.trim()}\n                      className=\"bg-blue-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50\"\n                    >\n                      Actualizar\n                    </button>\n                  </div>\n                  <p className=\"text-sm text-gray-600 mt-2\">\n                    Solo actualiza tu API Key si necesitas cambiarla o si la actual no funciona.\n                  </p>\n                </div>\n              </div>\n            </motion.div>\n          )}\n\n          {/* Privacy Tab */}\n          {activeTab === 'privacy' && (\n            <motion.div variants={itemVariants} className=\"p-8 space-y-8\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Privacidad y Seguridad</h2>\n              \n              <div className=\"space-y-6\">\n                <div className=\"bg-green-50 border border-green-200 rounded-xl p-6\">\n                  <h3 className=\"font-semibold text-green-900 mb-2\">🔒 Tus Datos están Seguros</h3>\n                  <ul className=\"text-sm text-green-800 space-y-1\">\n                    <li>• Tu API Key se almacena encriptada</li>\n                    <li>• Tus ejercicios se generan en tiempo real</li>\n                    <li>• No compartimos tus datos con terceros</li>\n                    <li>• Puedes exportar o eliminar tus datos en cualquier momento</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <button\n                    onClick={handleSignOut}\n                    className=\"w-full flex items-center justify-center space-x-2 bg-gray-100 text-gray-800 py-3 rounded-xl font-medium hover:bg-gray-200 transition-colors\"\n                  >\n                    <LogOut className=\"w-5 h-5\" />\n                    <span>Cerrar Sesión</span>\n                  </button>\n\n                  <button\n                    onClick={handleDeleteAccount}\n                    disabled={isLoading}\n                    className=\"w-full flex items-center justify-center space-x-2 bg-red-100 text-red-800 py-3 rounded-xl font-medium hover:bg-red-200 transition-colors disabled:opacity-50\"\n                  >\n                    <Trash2 className=\"w-5 h-5\" />\n                    <span>Eliminar Cuenta</span>\n                  </button>\n                </div>\n\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-6\">\n                  <h3 className=\"font-semibold text-yellow-900 mb-2\">⚠️ Eliminar Cuenta</h3>\n                  <p className=\"text-sm text-yellow-800\">\n                    Al eliminar tu cuenta se borrarán permanentemente todos tus datos, progreso, \n                    y configuraciones. Esta acción no se puede deshacer.\n                  </p>\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </div>\n      </main>\n    </motion.div>\n  );\n};","/**\n * ENGLISH MASTER APP - APLICACIÓN PRINCIPAL\n * Sistema completo de aprendizaje de inglés con IA personalizada\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\nimport { onAuthStateChanged, User } from 'firebase/auth';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Toaster } from 'react-hot-toast';\n\n// Firebase\nimport { auth } from './services/firebase/config';\n\n// Services\nimport { ProgressService } from './services/firebase/ProgressService';\n\n// Components\nimport { AuthScreen } from './components/auth/AuthScreen';\nimport { APIKeySetup } from './components/auth/APIKeySetup';\nimport { Dashboard } from './components/dashboard/Dashboard';\nimport { LearningSession } from './components/learning/LearningSession';\nimport { ProgressView } from './components/progress/ProgressView';\nimport { SettingsView } from './components/settings/SettingsView';\n\n// Types\nimport { UserProgress, SessionResults } from './types/progress';\n\n// Loading Component\nconst LoadingSpinner: React.FC = () => (\n  <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center\">\n    <motion.div\n      initial={{ opacity: 0, scale: 0.8 }}\n      animate={{ opacity: 1, scale: 1 }}\n      className=\"text-center\"\n    >\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n        className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4\"\n      />\n      <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">English Master</h2>\n      <p className=\"text-gray-600\">Cargando tu experiencia personalizada...</p>\n    </motion.div>\n  </div>\n);\n\n// Error Boundary Component\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error?: Error;\n}\n\nclass ErrorBoundary extends React.Component<React.PropsWithChildren<{}>, ErrorBoundaryState> {\n  constructor(props: React.PropsWithChildren<{}>) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error('English Master Error:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4\">\n          <div className=\"max-w-md mx-auto text-center\">\n            <div className=\"text-6xl mb-4\">😕</div>\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">\n              Algo salió mal\n            </h2>\n            <p className=\"text-gray-600 mb-6\">\n              Ha ocurrido un error inesperado. Por favor recarga la página.\n            </p>\n            <button\n              onClick={() => window.location.reload()}\n              className=\"bg-blue-500 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-600 transition-colors\"\n            >\n              Recargar Página\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children as React.ReactElement;\n  }\n}\n\n// Main App Component\nconst App: React.FC = () => {\n  // Estados principales\n  const [user, setUser] = useState<User | null>(null);\n  const [userProgress, setUserProgress] = useState<UserProgress | null>(null);\n  const [apiKey, setApiKey] = useState<string>('');\n  const [loading, setLoading] = useState(true);\n  const [currentView, setCurrentView] = useState<'dashboard' | 'session' | 'progress' | 'settings'>('dashboard');\n\n  const progressService = new ProgressService();\n\n  // Inicialización de la app\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      try {\n        if (user) {\n          console.log('👤 Usuario autenticado:', user.email);\n          setUser(user);\n          \n          // Cargar progreso del usuario\n          let progress = await progressService.getUserProgress(user.uid);\n          \n          if (!progress) {\n            console.log('🆕 Nuevo usuario detectado');\n            // Verificar si tiene API key guardada\n            const savedAPIKey = localStorage.getItem('gemini_api_key');\n            if (savedAPIKey) {\n              console.log('🔑 API Key encontrada, inicializando progreso...');\n              progress = await progressService.initializeUserProgress(user.uid, user.email!, savedAPIKey);\n              setApiKey(savedAPIKey);\n            }\n          } else {\n            console.log('📊 Progreso del usuario cargado');\n            // Usuario existente - cargar API key\n            const decryptedKey = atob(progress.apiKey); // Desencriptar\n            setApiKey(decryptedKey);\n          }\n          \n          setUserProgress(progress);\n        } else {\n          console.log('👤 Usuario no autenticado');\n          setUser(null);\n          setUserProgress(null);\n          setApiKey('');\n        }\n      } catch (error) {\n        console.error('❌ Error en inicialización:', error);\n      } finally {\n        setLoading(false);\n      }\n    });\n\n    return unsubscribe;\n  }, []);\n\n  // Manejar completación de sesión\n  const handleSessionComplete = async (sessionResults: SessionResults) => {\n    if (!user || !userProgress) return;\n    \n    try {\n      console.log('📊 Completando sesión:', sessionResults);\n      \n      const updatedProgress = await progressService.updateProgress(user.uid, sessionResults);\n      setUserProgress(updatedProgress);\n      \n      // Verificar level up\n      if (updatedProgress.currentLevel !== userProgress.currentLevel) {\n        console.log(`🎉 LEVEL UP: ${userProgress.currentLevel} → ${updatedProgress.currentLevel}`);\n        // TODO: Mostrar celebración de level up\n      }\n      \n      // Volver al dashboard\n      setCurrentView('dashboard');\n      \n    } catch (error) {\n      console.error('❌ Error completando sesión:', error);\n    }\n  };\n\n  // Manejar configuración de API Key\n  const handleAPIKeySetup = async (key: string) => {\n    if (!user) return;\n    \n    try {\n      console.log('🔑 Configurando API Key para usuario:', user.email);\n      \n      const progress = await progressService.initializeUserProgress(user.uid, user.email!, key);\n      setApiKey(key);\n      setUserProgress(progress);\n      \n      console.log('✅ Usuario inicializado exitosamente');\n      \n    } catch (error) {\n      console.error('❌ Error configurando API Key:', error);\n    }\n  };\n\n  // Estados de carga\n  if (loading) {\n    return <LoadingSpinner />;\n  }\n\n  // Usuario no autenticado\n  if (!user) {\n    return <AuthScreen />;\n  }\n\n  // Usuario sin API Key configurada\n  if (!apiKey || !userProgress) {\n    return <APIKeySetup onComplete={handleAPIKeySetup} />;\n  }\n\n  // Aplicación principal\n  return (\n    <ErrorBoundary>\n      <Router>\n        <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50\">\n          <AnimatePresence mode=\"wait\">\n            <Routes>\n              <Route\n                path=\"/\"\n                element={\n                  currentView === 'dashboard' ? (\n                    <Dashboard\n                      userProgress={userProgress}\n                      onStartSession={() => setCurrentView('session')}\n                      onViewProgress={() => setCurrentView('progress')}\n                      onSettings={() => setCurrentView('settings')}\n                    />\n                  ) : currentView === 'session' ? (\n                    <LearningSession\n                      userProgress={userProgress}\n                      apiKey={apiKey}\n                      onComplete={handleSessionComplete}\n                      onExit={() => setCurrentView('dashboard')}\n                    />\n                  ) : currentView === 'progress' ? (\n                    <ProgressView\n                      userProgress={userProgress}\n                      onBack={() => setCurrentView('dashboard')}\n                    />\n                  ) : (\n                    <SettingsView\n                      userProgress={userProgress}\n                      onBack={() => setCurrentView('dashboard')}\n                      onUpdateProgress={setUserProgress}\n                    />\n                  )\n                }\n              />\n              <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n            </Routes>\n          </AnimatePresence>\n        </div>\n      </Router>\n      \n      {/* Notificaciones */}\n      <Toaster\n        position=\"top-right\"\n        toastOptions={{\n          duration: 4000,\n          style: {\n            background: '#363636',\n            color: '#fff',\n          },\n        }}\n      />\n    </ErrorBoundary>\n  );\n};\n\nexport default App;","/**\n * MAIN ENTRY POINT - ENGLISH MASTER APP\n * Inicialización de React y configuración global\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport './styles/globals.css'\n\n// Development mode logging\nif (import.meta.env.DEV) {\n  console.log('🚀 English Master App - Development Mode')\n}\n\n// Service Worker registration (para PWA en el futuro)\nif ('serviceWorker' in navigator && import.meta.env.PROD) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n      .then((registration) => {\n        console.log('SW registered: ', registration)\n      })\n      .catch((registrationError) => {\n        console.log('SW registration failed: ', registrationError)\n      })\n  })\n}\n\n// Performance monitoring\nif (import.meta.env.PROD) {\n  console.log('📊 Performance monitoring enabled')\n}\n\n// Global error handling\nwindow.addEventListener('error', (event) => {\n  console.error('Global error:', event.error)\n  // Aquí podrías enviar errores a un servicio de monitoreo\n})\n\nwindow.addEventListener('unhandledrejection', (event) => {\n  console.error('Unhandled promise rejection:', event.reason)\n  // Aquí podrías enviar errores a un servicio de monitoreo\n})\n\n// Render the app\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)"],"names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","name","version","SDK_VERSION","TRACE_START_MARK_PREFIX","TRACE_STOP_MARK_PREFIX","TRACE_MEASURE_PREFIX","OOB_TRACE_PAGE_LOAD_PREFIX","FIRST_PAINT_COUNTER_NAME","FIRST_CONTENTFUL_PAINT_COUNTER_NAME","FIRST_INPUT_DELAY_COUNTER_NAME","CONFIG_LOCAL_STORAGE_KEY","CONFIG_EXPIRY_LOCAL_STORAGE_KEY","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","ErrorFactory","consoleLogger","Logger","LogLevel","apiInstance","windowInstance","Api","window","measureName","mark1","mark2","type","areCookiesEnabled","isIndexedDBAvailable","entryType","callback","list","entry","setupApi","iid","getIidPromise","installationsService","iidPromise","iidVal","getIid","getAuthTokenPromise","authTokenPromise","authTokenVal","mergeStrings","part1","part2","sizeDiff","resultArray","settingsServiceInstance","SettingsService","VisibilityState","RESERVED_ATTRIBUTE_PREFIXES","ATTRIBUTE_FORMAT_REGEX","MAX_ATTRIBUTE_NAME_LENGTH","MAX_ATTRIBUTE_VALUE_LENGTH","getServiceWorkerStatus","navigator","getVisibilityState","getEffectiveConnectionType","navigatorConnection","isValidCustomAttributeName","prefix","isValidCustomAttributeValue","value","getAppId","firebaseApp","_a","appId","getProjectId","projectId","getApiKey","apiKey","REMOTE_CONFIG_SDK_VERSION","DEFAULT_CONFIGS","FIS_AUTH_PREFIX","getConfig","performanceController","config","getStoredConfig","processConfig","getRemoteConfig","storeConfig","localStorage","expiryString","configValid","configStringified","COULD_NOT_GET_CONFIG_MSG","authToken","configEndPoint","request","response","entries","shouldLogAfterSampling","expiry","samplingRate","initializationStatus","initializationPromise","getInitializationPromise","initializePerf","isPerfInitialized","getDocumentReadyComplete","changeInitializationStatus","document","resolve","handler","DEFAULT_SEND_INTERVAL_MS","INITIAL_SEND_TIME_DELAY_MS","DEFAULT_REMAINING_TRIES","MAX_EVENT_COUNT_PER_REQUEST","remainingTries","queue","isTransportSetup","setupTransportService","processQueue","timeOffset","dispatchQueueEvents","staged","log_event","evt","data","sendEventsToFl","postToFlEndpoint","res","transportWait","requestOffset","logResponseDetails","flTransportFullUrl","addToQueue","transportHandler","serializer","args","message","logger","sendLog","resource","resourceType","logTrace","trace","settingsService","sendTraceLog","logNetworkRequest","networkRequest","networkRequestUrl","logEndpointUrl","flEndpointUrl","serializeNetworkRequest","serializeTrace","networkRequestMetric","perfMetric","getApplicationInfo","traceMetric","customAttributes","MAX_METRIC_NAME_LENGTH","RESERVED_AUTO_PREFIX","oobMetrics","isValidMetricName","traceName","convertMetricValueToInteger","providedValue","valueAsInteger","Trace","isAuto","traceMeasureName","startTime","duration","options","metricName","counter","numAsInteger","attr","isValidName","isValidValue","perfMeasureEntries","perfMeasureEntry","navigationTimings","paintTimings","firstInputDelay","route","timeOriginUs","FIRST_PAINT","FIRST_CONTENTFUL_PAINT","firstPaint","paintObject","firstContentfulPaint","createNetworkRequestEntry","performanceEntry","timeOrigin","startTimeUs","timeToResponseInitiatedUs","timeToResponseCompletedUs","url","FID_WAIT_TIME_MS","setupOobResources","setupOobTraces","setupNetworkRequests","setupUserTimingTraces","api","resources","timeoutId","fid","measures","measure","createUserTimingTrace","PerformanceController","app","installations","settings","validateIndexedDBOpenable","isAvailable","error","val","DEFAULT_ENTRY_NAME","getPerformance","getApp","getModularInstance","_getProvider","factory","container","perfInstance","registerPerformance","_registerComponent","Component","registerVersion","firebaseConfig","initializeApp","auth","getAuth","getFirestore","isSupported","supported","getAnalytics","ProgressService","userId","email","initialProgress","setDoc","doc","Timestamp","sessionResults","runTransaction","transaction","progressRef","progressDoc","currentProgress","newTotalExercises","newTotalCorrect","newOverallAccuracy","currentLevel","levelStats","updatedLevelStats","progressCalc","newLevel","updatedLevelProgress","today","yesterday","lastActiveDate","newStreak","updatedProgress","getDoc","level","stats","requirements","exerciseProgress","accuracyProgress","sessionProgress","timeProgress","progressPercentage","canLevelUp","blockedBy","userProgress","dailyRef","dailyDoc","dailyProgress","isUnlocked","levels","currentIndex","current","newWeak","counts","acc","area","_","count","focused","accuracy","combined","exercisesNeeded","averageTimePerExercise","encryptedKey","AuthScreen","isLogin","setIsLogin","useState","setEmail","password","setPassword","showPassword","setShowPassword","loading","setLoading","setError","googleProvider","GoogleAuthProvider","handleGoogleSignIn","result","signInWithPopup","toast","handleEmailAuth","signInWithEmailAndPassword","createUserWithEmailAndPassword","errorMessages","handleForgotPassword","sendPasswordResetEmail","jsx","motion","jsxs","Mail","Lock","EyeOff","Eye","AlertCircle","CheckCircle","Sparkles","PromptTemplates","params","GeminiService","GoogleGenerativeAI","prompt","jsonMatch","exerciseData","validatedExercises","i","exercise","validation","processedExercise","shuffledExercise","errors","warnings","pedagogicalScore","socialValidation","diversityValidation","score","option","situation","correctOption","socialRules","rule","expected","text","spanishWords","englishWords","lowerText","spanishCount","word","englishCount","survivalKeywords","keyword","advancedWords","a2Patterns","pattern","lengths","opt","avgLength","sum","len","uniqueWords","correctAnswerText","shuffledOptions","j","newCorrectAnswer","difficulty","questionLength","emergencyExercises","APIKeySetup","onComplete","setApiKey","isValidating","setIsValidating","showKey","setShowKey","currentStep","setCurrentStep","validateAPIKey","key","testExercises","handleValidateKey","containerVariants","itemVariants","Key","Shield","Zap","Lightbulb","ExternalLink","Dashboard","onStartSession","onViewProgress","onSettings","setProgressCalc","showLevelUpCelebration","setShowLevelUpCelebration","progressService","useEffect","currentLevelStats","calc","Settings","requirement","index","StatsCard","Star","Target","Clock","isCurrent","isCompleted","LevelCard","Play","BarChart3","AnimatePresence","LevelUpCelebration","title","icon","color","subtitle","colorClasses","onClose","LearningSession","onExit","exercises","setExercises","setCurrentIndex","selectedAnswer","setSelectedAnswer","showFeedback","setShowFeedback","isLoading","setIsLoading","sessionStartTime","correctAnswers","setCorrectAnswers","timeSpent","setTimeSpent","skillsFocused","setSkillsFocused","weakAreas","setWeakAreas","geminiService","currentExercise","isLastExercise","timer","generateSession","generatedExercises","handleAnswerSelect","answerIndex","prev","handleContinue","completeSession","speakText","utterance","ArrowLeft","Volume2","isSelected","isCorrect","showResult","optionClass","XCircle","ArrowRight","RotateCcw","ProgressView","onBack","timeRange","setTimeRange","activeTab","setActiveTab","weeklyData","levelData","skillsData","TrendingUp","Award","tab","Icon","Activity","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Line","BarChart","Bar","skill","AchievementCard","change","period","description","unlocked","date","SettingsView","onUpdateProgress","showApiKey","setShowApiKey","editedPreferences","setEditedPreferences","newApiKey","setNewApiKey","handleSavePreferences","handleUpdateApiKey","handleSignOut","signOut","handleDeleteAccount","User","Bell","Palette","Globe","Save","LogOut","Trash2","LoadingSpinner","ErrorBoundary","React","props","errorInfo","App","user","setUser","setUserProgress","currentView","setCurrentView","onAuthStateChanged","progress","decryptedKey","savedAPIKey","handleSessionComplete","handleAPIKeySetup","Router","Routes","Route","Navigate","Toaster","registration","registrationError","event","ReactDOM"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}